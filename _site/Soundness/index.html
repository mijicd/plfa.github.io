<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: Soundness of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: Soundness of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: Soundness of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">The Book</a>
                <a class="page-link" href="/Announcements/">Announcements</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
                <a class="page-link" href="/Citing/">Citing</a>
                <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: Soundness of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="193" class="Keyword">module</a> <a id="200" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="215" class="Keyword">where</a>
</pre>

<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="1079" class="Keyword">open</a> <a id="1084" class="Keyword">import</a> <a id="1091" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="1106" class="Keyword">using</a> <a id="1112" class="Symbol">(</a><a id="1113" href="/Untyped/#3130" class="Datatype">Context</a><a id="1120" class="Symbol">;</a> <a id="1122" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">_,_</a><a id="1125" class="Symbol">;</a> <a id="1127" href="plfa.Untyped.html#3483" class="Datatype Operator">_∋_</a><a id="1130" class="Symbol">;</a> <a id="1132" href="plfa.Untyped.html#4252" class="Datatype Operator">_⊢_</a><a id="1135" class="Symbol">;</a> <a id="1137" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="1138" class="Symbol">;</a> <a id="1140" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a><a id="1141" class="Symbol">;</a> <a id="1143" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a><a id="1145" class="Symbol">;</a> <a id="1147" href="plfa.Untyped.html#4288" class="InductiveConstructor Operator">`_</a><a id="1149" class="Symbol">;</a> <a id="1151" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ_</a><a id="1153" class="Symbol">;</a> <a id="1155" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">_·_</a><a id="1158" class="Symbol">;</a>
         <a id="1169" href="/Untyped/#6921" class="Function">subst</a><a id="1174" class="Symbol">;</a> <a id="1176" href="plfa.Untyped.html#7449" class="Function Operator">_[_]</a><a id="1180" class="Symbol">;</a> <a id="1182" href="plfa.Untyped.html#7333" class="Function">subst-zero</a><a id="1192" class="Symbol">;</a> <a id="1194" href="plfa.Untyped.html#5883" class="Function">ext</a><a id="1197" class="Symbol">;</a> <a id="1199" href="plfa.Untyped.html#6193" class="Function">rename</a><a id="1205" class="Symbol">;</a> <a id="1207" href="plfa.Untyped.html#6629" class="Function">exts</a><a id="1211" class="Symbol">;</a>
         <a id="1222" href="/Untyped/#10105" class="Datatype Operator">_—→_</a><a id="1226" class="Symbol">;</a> <a id="1228" href="plfa.Untyped.html#10155" class="InductiveConstructor">ξ₁</a><a id="1230" class="Symbol">;</a> <a id="1232" href="plfa.Untyped.html#10245" class="InductiveConstructor">ξ₂</a><a id="1234" class="Symbol">;</a> <a id="1236" href="plfa.Untyped.html#10335" class="InductiveConstructor">β</a><a id="1237" class="Symbol">;</a> <a id="1239" href="plfa.Untyped.html#10443" class="InductiveConstructor">ζ</a><a id="1240" class="Symbol">;</a> <a id="1242" href="plfa.Untyped.html#11203" class="Datatype Operator">_—↠_</a><a id="1246" class="Symbol">;</a> <a id="1248" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1255" class="Symbol">;</a> <a id="1257" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">_∎</a><a id="1259" class="Symbol">)</a>
<a id="1261" class="Keyword">open</a> <a id="1266" class="Keyword">import</a> <a id="1273" href="/Substitution/" class="Module">plfa.Substitution</a> <a id="1291" class="Keyword">using</a> <a id="1297" class="Symbol">(</a><a id="1298" href="plfa.Substitution.html#2247" class="Function">Rename</a><a id="1304" class="Symbol">;</a> <a id="1306" href="plfa.Substitution.html#2460" class="Function">Subst</a><a id="1311" class="Symbol">;</a> <a id="1313" href="plfa.Substitution.html#3101" class="Function">ids</a><a id="1316" class="Symbol">)</a>
<a id="1318" class="Keyword">open</a> <a id="1323" class="Keyword">import</a> <a id="1330" href="/Denotational/" class="Module">plfa.Denotational</a>
  <a id="1350" class="Keyword">using</a> <a id="1356" class="Symbol">(</a><a id="1357" href="/Denotational/#3971" class="Datatype">Value</a><a id="1362" class="Symbol">;</a> <a id="1364" href="plfa.Denotational.html#3991" class="InductiveConstructor">⊥</a><a id="1365" class="Symbol">;</a> <a id="1367" href="plfa.Denotational.html#7109" class="Function">Env</a><a id="1370" class="Symbol">;</a> <a id="1372" href="plfa.Denotational.html#9283" class="Datatype Operator">_⊢_↓_</a><a id="1377" class="Symbol">;</a> <a id="1379" href="plfa.Denotational.html#7266" class="Function Operator">_`,_</a><a id="1383" class="Symbol">;</a> <a id="1385" href="plfa.Denotational.html#4326" class="Datatype Operator">_⊑_</a><a id="1388" class="Symbol">;</a> <a id="1390" href="plfa.Denotational.html#8071" class="Function Operator">_`⊑_</a><a id="1394" class="Symbol">;</a> <a id="1396" href="plfa.Denotational.html#8274" class="Function">`⊥</a><a id="1398" class="Symbol">;</a> <a id="1400" href="plfa.Denotational.html#8303" class="Function Operator">_`⊔_</a><a id="1404" class="Symbol">;</a> <a id="1406" href="plfa.Denotational.html#7503" class="Function">init</a><a id="1410" class="Symbol">;</a> <a id="1412" href="plfa.Denotational.html#7558" class="Function">last</a><a id="1416" class="Symbol">;</a> <a id="1418" href="plfa.Denotational.html#7607" class="Function">init-last</a><a id="1427" class="Symbol">;</a>
         <a id="1438" href="/Denotational/#5480" class="Function">Refl⊑</a><a id="1443" class="Symbol">;</a> <a id="1445" href="plfa.Denotational.html#4623" class="InductiveConstructor">Trans⊑</a><a id="1451" class="Symbol">;</a> <a id="1453" href="plfa.Denotational.html#8557" class="Function">`Refl⊑</a><a id="1459" class="Symbol">;</a> <a id="1461" href="plfa.Denotational.html#25246" class="Function">Env⊑</a><a id="1465" class="Symbol">;</a> <a id="1467" href="plfa.Denotational.html#8625" class="Function">EnvConjR1⊑</a><a id="1477" class="Symbol">;</a> <a id="1479" href="plfa.Denotational.html#8722" class="Function">EnvConjR2⊑</a><a id="1489" class="Symbol">;</a> <a id="1491" href="plfa.Denotational.html#25674" class="Function">up-env</a><a id="1497" class="Symbol">;</a>
         <a id="1508" href="/Denotational/#9337" class="InductiveConstructor">var</a><a id="1511" class="Symbol">;</a> <a id="1513" href="plfa.Denotational.html#9416" class="InductiveConstructor">↦-elim</a><a id="1519" class="Symbol">;</a> <a id="1521" href="plfa.Denotational.html#9554" class="InductiveConstructor">↦-intro</a><a id="1528" class="Symbol">;</a> <a id="1530" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a><a id="1537" class="Symbol">;</a> <a id="1539" href="plfa.Denotational.html#9753" class="InductiveConstructor">⊔-intro</a><a id="1546" class="Symbol">;</a> <a id="1548" href="plfa.Denotational.html#9884" class="InductiveConstructor">sub</a><a id="1551" class="Symbol">;</a>
         <a id="1562" href="/Denotational/#23654" class="Function">rename-pres</a><a id="1573" class="Symbol">;</a> <a id="1575" href="plfa.Denotational.html#17453" class="Function">ℰ</a><a id="1576" class="Symbol">;</a> <a id="1578" href="plfa.Denotational.html#17635" class="Function Operator">_≃_</a><a id="1581" class="Symbol">;</a> <a id="1583" href="plfa.Denotational.html#18040" class="Function">≃-trans</a><a id="1590" class="Symbol">)</a>
<a id="1592" class="Keyword">open</a> <a id="1597" class="Keyword">import</a> <a id="1604" href="/Compositional/" class="Module">plfa.Compositional</a> <a id="1623" class="Keyword">using</a> <a id="1629" class="Symbol">(</a><a id="1630" href="plfa.Compositional.html#3566" class="Function">lambda-inversion</a><a id="1646" class="Symbol">;</a> <a id="1648" href="plfa.Compositional.html#9665" class="Function">var-inv</a><a id="1655" class="Symbol">)</a>

<a id="1658" class="Keyword">open</a> <a id="1663" class="Keyword">import</a> <a id="1670" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1710" class="Keyword">using</a> <a id="1716" class="Symbol">(</a><a id="1717" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="1720" class="Symbol">;</a> <a id="1722" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">_≢_</a><a id="1725" class="Symbol">;</a> <a id="1727" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1731" class="Symbol">;</a> <a id="1733" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1736" class="Symbol">;</a> <a id="1738" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1742" class="Symbol">;</a> <a id="1744" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">cong₂</a><a id="1749" class="Symbol">;</a> <a id="1751" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a><a id="1759" class="Symbol">)</a>
<a id="1761" class="Keyword">open</a> <a id="1766" class="Keyword">import</a> <a id="1773" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1786" class="Keyword">using</a> <a id="1792" class="Symbol">(</a><a id="1793" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="1796" class="Symbol">;</a> <a id="1798" href="Agda.Builtin.Sigma.html#139" class="Record">Σ</a><a id="1799" class="Symbol">;</a> <a id="1801" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="1809" class="Symbol">;</a> <a id="1811" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">∃</a><a id="1812" class="Symbol">;</a> <a id="1814" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">∃-syntax</a><a id="1822" class="Symbol">;</a> <a id="1824" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="1829" class="Symbol">;</a> <a id="1831" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="1836" class="Symbol">)</a>
  <a id="1840" class="Keyword">renaming</a> <a id="1849" class="Symbol">(</a><a id="1850" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1854" class="Symbol">to</a> <a id="1857" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1862" class="Symbol">)</a>
<a id="1864" class="Keyword">open</a> <a id="1869" class="Keyword">import</a> <a id="1876" href="Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1891" class="Keyword">using</a> <a id="1897" class="Symbol">(</a><a id="1898" href="Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1903" class="Symbol">)</a>
<a id="1905" class="Keyword">open</a> <a id="1910" class="Keyword">import</a> <a id="1917" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1934" class="Keyword">using</a> <a id="1940" class="Symbol">(</a><a id="1941" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="1943" class="Symbol">)</a>
<a id="1945" class="Keyword">open</a> <a id="1950" class="Keyword">import</a> <a id="1957" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="1983" class="Keyword">using</a> <a id="1989" class="Symbol">(</a><a id="1990" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#809" class="Function">contradiction</a><a id="2003" class="Symbol">)</a>
<a id="2005" class="Keyword">open</a> <a id="2010" class="Keyword">import</a> <a id="2017" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="2028" class="Keyword">using</a> <a id="2034" class="Symbol">(</a><a id="2035" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="2041" class="Symbol">)</a>
<a id="2043" class="Keyword">open</a> <a id="2048" class="Keyword">import</a> <a id="2055" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="2072" class="Keyword">using</a> <a id="2078" class="Symbol">(</a><a id="2079" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="2082" class="Symbol">;</a> <a id="2084" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="2087" class="Symbol">;</a> <a id="2089" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="2091" class="Symbol">)</a>
<a id="2093" class="Keyword">open</a> <a id="2098" class="Keyword">import</a> <a id="2105" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="2114" class="Keyword">using</a> <a id="2120" class="Symbol">(</a><a id="2121" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_∘_</a><a id="2124" class="Symbol">)</a>
<a id="2126" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a>
</pre>
<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3192" class="Keyword">infix</a> <a id="3198" class="Number">3</a> <a id="3200" href="/Soundness/#3207" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3207" href="/Soundness/#3207" class="Function Operator">_`⊢_↓_</a> <a id="3214" class="Symbol">:</a> <a id="3216" class="Symbol">∀{</a><a id="3218" href="plfa.Soundness.html#3218" class="Bound">Δ</a> <a id="3220" href="plfa.Soundness.html#3220" class="Bound">Γ</a><a id="3221" class="Symbol">}</a> <a id="3223" class="Symbol">→</a> <a id="3225" href="/Denotational/#7109" class="Function">Env</a> <a id="3229" href="plfa.Soundness.html#3218" class="Bound">Δ</a> <a id="3231" class="Symbol">→</a> <a id="3233" href="/Substitution/#2460" class="Function">Subst</a> <a id="3239" href="plfa.Soundness.html#3220" class="Bound">Γ</a> <a id="3241" href="plfa.Soundness.html#3218" class="Bound">Δ</a> <a id="3243" class="Symbol">→</a> <a id="3245" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="3249" href="plfa.Soundness.html#3220" class="Bound">Γ</a> <a id="3251" class="Symbol">→</a> <a id="3253" class="PrimitiveType">Set</a>
<a id="3257" href="/Soundness/#3207" class="Function Operator">_`⊢_↓_</a> <a id="3264" class="Symbol">{</a><a id="3265" href="plfa.Soundness.html#3265" class="Bound">Δ</a><a id="3266" class="Symbol">}{</a><a id="3268" href="plfa.Soundness.html#3268" class="Bound">Γ</a><a id="3269" class="Symbol">}</a> <a id="3271" href="plfa.Soundness.html#3271" class="Bound">δ</a> <a id="3273" href="plfa.Soundness.html#3273" class="Bound">σ</a> <a id="3275" href="plfa.Soundness.html#3275" class="Bound">γ</a> <a id="3277" class="Symbol">=</a> <a id="3279" class="Symbol">(∀</a> <a id="3282" class="Symbol">(</a><a id="3283" href="plfa.Soundness.html#3283" class="Bound">x</a> <a id="3285" class="Symbol">:</a> <a id="3287" href="plfa.Soundness.html#3268" class="Bound">Γ</a> <a id="3289" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="3291" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="3292" class="Symbol">)</a> <a id="3294" class="Symbol">→</a> <a id="3296" href="plfa.Soundness.html#3271" class="Bound">δ</a> <a id="3298" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="3300" href="plfa.Soundness.html#3273" class="Bound">σ</a> <a id="3302" href="plfa.Soundness.html#3283" class="Bound">x</a> <a id="3304" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="3306" href="plfa.Soundness.html#3275" class="Bound">γ</a> <a id="3308" href="plfa.Soundness.html#3283" class="Bound">x</a><a id="3309" class="Symbol">)</a>
</pre>
<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3574" href="/Soundness/#3574" class="Function">subst-ext</a> <a id="3584" class="Symbol">:</a> <a id="3586" class="Symbol">∀</a> <a id="3588" class="Symbol">{</a><a id="3589" href="plfa.Soundness.html#3589" class="Bound">Γ</a> <a id="3591" href="plfa.Soundness.html#3591" class="Bound">Δ</a> <a id="3593" href="plfa.Soundness.html#3593" class="Bound">v</a><a id="3594" class="Symbol">}</a> <a id="3596" class="Symbol">{</a><a id="3597" href="plfa.Soundness.html#3597" class="Bound">γ</a> <a id="3599" class="Symbol">:</a> <a id="3601" href="/Denotational/#7109" class="Function">Env</a> <a id="3605" href="plfa.Soundness.html#3589" class="Bound">Γ</a><a id="3606" class="Symbol">}</a> <a id="3608" class="Symbol">{</a><a id="3609" href="plfa.Soundness.html#3609" class="Bound">δ</a> <a id="3611" class="Symbol">:</a> <a id="3613" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="3617" href="plfa.Soundness.html#3591" class="Bound">Δ</a><a id="3618" class="Symbol">}</a>
  <a id="3622" class="Symbol">→</a> <a id="3624" class="Symbol">(</a><a id="3625" href="/Soundness/#3625" class="Bound">σ</a> <a id="3627" class="Symbol">:</a> <a id="3629" href="/Substitution/#2460" class="Function">Subst</a> <a id="3635" href="plfa.Soundness.html#3589" class="Bound">Γ</a> <a id="3637" href="plfa.Soundness.html#3591" class="Bound">Δ</a><a id="3638" class="Symbol">)</a>
  <a id="3642" class="Symbol">→</a> <a id="3644" href="/Soundness/#3609" class="Bound">δ</a> <a id="3646" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="3649" href="plfa.Soundness.html#3625" class="Bound">σ</a> <a id="3651" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="3653" href="plfa.Soundness.html#3597" class="Bound">γ</a>
   <a id="3658" class="Comment">--------------------------</a>
  <a id="3687" class="Symbol">→</a> <a id="3689" href="/Soundness/#3609" class="Bound">δ</a> <a id="3691" href="/Denotational/#7266" class="Function Operator">`,</a> <a id="3694" href="plfa.Soundness.html#3593" class="Bound">v</a> <a id="3696" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="3699" href="/Untyped/#6629" class="Function">exts</a> <a id="3704" href="plfa.Soundness.html#3625" class="Bound">σ</a> <a id="3706" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="3708" href="plfa.Soundness.html#3597" class="Bound">γ</a> <a id="3710" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="3713" href="plfa.Soundness.html#3593" class="Bound">v</a>
<a id="3715" href="/Soundness/#3574" class="Function">subst-ext</a> <a id="3725" href="plfa.Soundness.html#3725" class="Bound">σ</a> <a id="3727" href="plfa.Soundness.html#3727" class="Bound">d</a> <a id="3729" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="3731" class="Symbol">=</a> <a id="3733" href="/Denotational/#9337" class="InductiveConstructor">var</a>
<a id="3737" href="/Soundness/#3574" class="Function">subst-ext</a> <a id="3747" href="plfa.Soundness.html#3747" class="Bound">σ</a> <a id="3749" href="plfa.Soundness.html#3749" class="Bound">d</a> <a id="3751" class="Symbol">(</a><a id="3752" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="3754" href="plfa.Soundness.html#3754" class="Bound">x′</a><a id="3756" class="Symbol">)</a> <a id="3758" class="Symbol">=</a> <a id="3760" href="/Denotational/#23654" class="Function">rename-pres</a> <a id="3772" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="3775" class="Symbol">(λ</a> <a id="3778" href="plfa.Soundness.html#3778" class="Bound">_</a> <a id="3780" class="Symbol">→</a> <a id="3782" href="plfa.Denotational.html#5480" class="Function">Refl⊑</a><a id="3787" class="Symbol">)</a> <a id="3789" class="Symbol">(</a><a id="3790" href="plfa.Soundness.html#3749" class="Bound">d</a> <a id="3792" href="plfa.Soundness.html#3754" class="Bound">x′</a><a id="3794" class="Symbol">)</a>
</pre>
<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x′</code>,then we need to show that
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4211" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4222" class="Symbol">:</a> <a id="4224" class="Symbol">∀</a> <a id="4226" class="Symbol">{</a><a id="4227" href="plfa.Soundness.html#4227" class="Bound">Γ</a> <a id="4229" href="plfa.Soundness.html#4229" class="Bound">Δ</a> <a id="4231" href="plfa.Soundness.html#4231" class="Bound">v</a><a id="4232" class="Symbol">}</a> <a id="4234" class="Symbol">{</a><a id="4235" href="plfa.Soundness.html#4235" class="Bound">γ</a> <a id="4237" class="Symbol">:</a> <a id="4239" href="/Denotational/#7109" class="Function">Env</a> <a id="4243" href="plfa.Soundness.html#4227" class="Bound">Γ</a><a id="4244" class="Symbol">}</a> <a id="4246" class="Symbol">{</a><a id="4247" href="plfa.Soundness.html#4247" class="Bound">δ</a> <a id="4249" class="Symbol">:</a> <a id="4251" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="4255" href="plfa.Soundness.html#4229" class="Bound">Δ</a><a id="4256" class="Symbol">}</a> <a id="4258" class="Symbol">{</a><a id="4259" href="plfa.Soundness.html#4259" class="Bound">M</a> <a id="4261" class="Symbol">:</a> <a id="4263" href="plfa.Soundness.html#4227" class="Bound">Γ</a> <a id="4265" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="4267" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="4268" class="Symbol">}</a>
  <a id="4272" class="Symbol">→</a> <a id="4274" class="Symbol">(</a><a id="4275" href="/Soundness/#4275" class="Bound">σ</a> <a id="4277" class="Symbol">:</a> <a id="4279" href="/Substitution/#2460" class="Function">Subst</a> <a id="4285" href="plfa.Soundness.html#4227" class="Bound">Γ</a> <a id="4287" href="plfa.Soundness.html#4229" class="Bound">Δ</a><a id="4288" class="Symbol">)</a>
  <a id="4292" class="Symbol">→</a> <a id="4294" href="/Soundness/#4247" class="Bound">δ</a> <a id="4296" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="4299" href="plfa.Soundness.html#4275" class="Bound">σ</a> <a id="4301" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="4303" href="plfa.Soundness.html#4235" class="Bound">γ</a>
  <a id="4307" class="Symbol">→</a> <a id="4309" href="/Soundness/#4235" class="Bound">γ</a> <a id="4311" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="4313" href="plfa.Soundness.html#4259" class="Bound">M</a> <a id="4315" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="4317" href="plfa.Soundness.html#4231" class="Bound">v</a>
    <a id="4323" class="Comment">------------------</a>
  <a id="4344" class="Symbol">→</a> <a id="4346" href="/Soundness/#4247" class="Bound">δ</a> <a id="4348" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="4350" href="/Untyped/#6921" class="Function">subst</a> <a id="4356" href="plfa.Soundness.html#4275" class="Bound">σ</a> <a id="4358" href="plfa.Soundness.html#4259" class="Bound">M</a> <a id="4360" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="4362" href="plfa.Soundness.html#4231" class="Bound">v</a>
<a id="4364" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4375" href="plfa.Soundness.html#4375" class="Bound">σ</a> <a id="4377" href="plfa.Soundness.html#4377" class="Bound">s</a> <a id="4379" class="Symbol">(</a><a id="4380" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="4384" class="Symbol">{</a><a id="4385" class="Argument">x</a> <a id="4387" class="Symbol">=</a> <a id="4389" href="plfa.Soundness.html#4389" class="Bound">x</a><a id="4390" class="Symbol">})</a> <a id="4393" class="Symbol">=</a> <a id="4395" class="Symbol">(</a><a id="4396" href="plfa.Soundness.html#4377" class="Bound">s</a> <a id="4398" href="plfa.Soundness.html#4389" class="Bound">x</a><a id="4399" class="Symbol">)</a>
<a id="4401" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4412" href="plfa.Soundness.html#4412" class="Bound">σ</a> <a id="4414" href="plfa.Soundness.html#4414" class="Bound">s</a> <a id="4416" class="Symbol">(</a><a id="4417" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="4424" href="plfa.Soundness.html#4424" class="Bound">d₁</a> <a id="4427" href="plfa.Soundness.html#4427" class="Bound">d₂</a><a id="4429" class="Symbol">)</a> <a id="4431" class="Symbol">=</a>
  <a id="4435" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="4442" class="Symbol">(</a><a id="4443" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4454" href="plfa.Soundness.html#4412" class="Bound">σ</a> <a id="4456" href="plfa.Soundness.html#4414" class="Bound">s</a> <a id="4458" href="plfa.Soundness.html#4424" class="Bound">d₁</a><a id="4460" class="Symbol">)</a> <a id="4462" class="Symbol">(</a><a id="4463" href="plfa.Soundness.html#4211" class="Function">subst-pres</a> <a id="4474" href="plfa.Soundness.html#4412" class="Bound">σ</a> <a id="4476" href="plfa.Soundness.html#4414" class="Bound">s</a> <a id="4478" href="plfa.Soundness.html#4427" class="Bound">d₂</a><a id="4480" class="Symbol">)</a>
<a id="4482" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4493" href="plfa.Soundness.html#4493" class="Bound">σ</a> <a id="4495" href="plfa.Soundness.html#4495" class="Bound">s</a> <a id="4497" class="Symbol">(</a><a id="4498" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="4506" href="plfa.Soundness.html#4506" class="Bound">d</a><a id="4507" class="Symbol">)</a> <a id="4509" class="Symbol">=</a>
  <a id="4513" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="4521" class="Symbol">(</a><a id="4522" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4533" class="Symbol">(λ</a> <a id="4536" class="Symbol">{</a><a id="4537" href="plfa.Soundness.html#4537" class="Bound">A</a><a id="4538" class="Symbol">}</a> <a id="4540" class="Symbol">→</a> <a id="4542" href="/Untyped/#6629" class="Function">exts</a> <a id="4547" href="plfa.Soundness.html#4493" class="Bound">σ</a><a id="4548" class="Symbol">)</a> <a id="4550" class="Symbol">(</a><a id="4551" href="plfa.Soundness.html#3574" class="Function">subst-ext</a> <a id="4561" href="plfa.Soundness.html#4493" class="Bound">σ</a> <a id="4563" href="plfa.Soundness.html#4495" class="Bound">s</a><a id="4564" class="Symbol">)</a> <a id="4566" href="plfa.Soundness.html#4506" class="Bound">d</a><a id="4567" class="Symbol">)</a>
<a id="4569" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4580" href="plfa.Soundness.html#4580" class="Bound">σ</a> <a id="4582" href="plfa.Soundness.html#4582" class="Bound">s</a> <a id="4584" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="4592" class="Symbol">=</a> <a id="4594" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a>
<a id="4602" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4613" href="plfa.Soundness.html#4613" class="Bound">σ</a> <a id="4615" href="plfa.Soundness.html#4615" class="Bound">s</a> <a id="4617" class="Symbol">(</a><a id="4618" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="4626" href="plfa.Soundness.html#4626" class="Bound">d₁</a> <a id="4629" href="plfa.Soundness.html#4629" class="Bound">d₂</a><a id="4631" class="Symbol">)</a> <a id="4633" class="Symbol">=</a>
  <a id="4637" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="4645" class="Symbol">(</a><a id="4646" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4657" href="plfa.Soundness.html#4613" class="Bound">σ</a> <a id="4659" href="plfa.Soundness.html#4615" class="Bound">s</a> <a id="4661" href="plfa.Soundness.html#4626" class="Bound">d₁</a><a id="4663" class="Symbol">)</a> <a id="4665" class="Symbol">(</a><a id="4666" href="plfa.Soundness.html#4211" class="Function">subst-pres</a> <a id="4677" href="plfa.Soundness.html#4613" class="Bound">σ</a> <a id="4679" href="plfa.Soundness.html#4615" class="Bound">s</a> <a id="4681" href="plfa.Soundness.html#4629" class="Bound">d₂</a><a id="4683" class="Symbol">)</a>
<a id="4685" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="4696" href="plfa.Soundness.html#4696" class="Bound">σ</a> <a id="4698" href="plfa.Soundness.html#4698" class="Bound">s</a> <a id="4700" class="Symbol">(</a><a id="4701" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="4705" href="plfa.Soundness.html#4705" class="Bound">d</a> <a id="4707" href="plfa.Soundness.html#4707" class="Bound">lt</a><a id="4709" class="Symbol">)</a> <a id="4711" class="Symbol">=</a> <a id="4713" href="plfa.Denotational.html#9884" class="InductiveConstructor">sub</a> <a id="4717" class="Symbol">(</a><a id="4718" href="plfa.Soundness.html#4211" class="Function">subst-pres</a> <a id="4729" href="plfa.Soundness.html#4696" class="Bound">σ</a> <a id="4731" href="plfa.Soundness.html#4698" class="Bound">s</a> <a id="4733" href="plfa.Soundness.html#4705" class="Bound">d</a><a id="4734" class="Symbol">)</a> <a id="4736" href="plfa.Soundness.html#4707" class="Bound">lt</a>
</pre>
<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5686" href="/Soundness/#5686" class="Function">substitution</a> <a id="5699" class="Symbol">:</a> <a id="5701" class="Symbol">∀</a> <a id="5703" class="Symbol">{</a><a id="5704" href="plfa.Soundness.html#5704" class="Bound">Γ</a><a id="5705" class="Symbol">}</a> <a id="5707" class="Symbol">{</a><a id="5708" href="plfa.Soundness.html#5708" class="Bound">γ</a> <a id="5710" class="Symbol">:</a> <a id="5712" href="/Denotational/#7109" class="Function">Env</a> <a id="5716" href="plfa.Soundness.html#5704" class="Bound">Γ</a><a id="5717" class="Symbol">}</a> <a id="5719" class="Symbol">{</a><a id="5720" href="plfa.Soundness.html#5720" class="Bound">N</a> <a id="5722" href="plfa.Soundness.html#5722" class="Bound">M</a> <a id="5724" href="plfa.Soundness.html#5724" class="Bound">v</a> <a id="5726" href="plfa.Soundness.html#5726" class="Bound">w</a><a id="5727" class="Symbol">}</a>
   <a id="5732" class="Symbol">→</a> <a id="5734" href="/Soundness/#5708" class="Bound">γ</a> <a id="5736" href="/Denotational/#7266" class="Function Operator">`,</a> <a id="5739" href="plfa.Soundness.html#5724" class="Bound">v</a> <a id="5741" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="5743" href="plfa.Soundness.html#5720" class="Bound">N</a> <a id="5745" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="5747" href="plfa.Soundness.html#5726" class="Bound">w</a>
   <a id="5752" class="Symbol">→</a> <a id="5754" href="/Soundness/#5708" class="Bound">γ</a> <a id="5756" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="5758" href="plfa.Soundness.html#5722" class="Bound">M</a> <a id="5760" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="5762" href="plfa.Soundness.html#5724" class="Bound">v</a>
     <a id="5769" class="Comment">---------------</a>
   <a id="5788" class="Symbol">→</a> <a id="5790" href="/Soundness/#5708" class="Bound">γ</a> <a id="5792" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="5794" href="plfa.Soundness.html#5720" class="Bound">N</a> <a id="5796" href="/Untyped/#7449" class="Function Operator">[</a> <a id="5798" href="plfa.Soundness.html#5722" class="Bound">M</a> <a id="5800" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="5802" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="5804" href="plfa.Soundness.html#5726" class="Bound">w</a>
<a id="5806" href="/Soundness/#5686" class="Function">substitution</a><a id="5818" class="Symbol">{</a><a id="5819" href="plfa.Soundness.html#5819" class="Bound">Γ</a><a id="5820" class="Symbol">}{</a><a id="5822" href="plfa.Soundness.html#5822" class="Bound">γ</a><a id="5823" class="Symbol">}{</a><a id="5825" href="plfa.Soundness.html#5825" class="Bound">N</a><a id="5826" class="Symbol">}{</a><a id="5828" href="plfa.Soundness.html#5828" class="Bound">M</a><a id="5829" class="Symbol">}{</a><a id="5831" href="plfa.Soundness.html#5831" class="Bound">v</a><a id="5832" class="Symbol">}{</a><a id="5834" href="plfa.Soundness.html#5834" class="Bound">w</a><a id="5835" class="Symbol">}</a> <a id="5837" href="plfa.Soundness.html#5837" class="Bound">dn</a> <a id="5840" href="plfa.Soundness.html#5840" class="Bound">dm</a> <a id="5843" class="Symbol">=</a>
  <a id="5847" href="/Soundness/#4211" class="Function">subst-pres</a> <a id="5858" class="Symbol">(</a><a id="5859" href="/Untyped/#7333" class="Function">subst-zero</a> <a id="5870" href="plfa.Soundness.html#5828" class="Bound">M</a><a id="5871" class="Symbol">)</a> <a id="5873" href="plfa.Soundness.html#5895" class="Function">sub-z-ok</a> <a id="5882" href="plfa.Soundness.html#5837" class="Bound">dn</a>
  <a id="5887" class="Keyword">where</a>
  <a id="5895" href="/Soundness/#5895" class="Function">sub-z-ok</a> <a id="5904" class="Symbol">:</a> <a id="5906" href="plfa.Soundness.html#5822" class="Bound">γ</a> <a id="5908" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="5911" href="/Untyped/#7333" class="Function">subst-zero</a> <a id="5922" href="plfa.Soundness.html#5828" class="Bound">M</a> <a id="5924" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="5926" class="Symbol">(</a><a id="5927" href="plfa.Soundness.html#5822" class="Bound">γ</a> <a id="5929" href="/Denotational/#7266" class="Function Operator">`,</a> <a id="5932" href="plfa.Soundness.html#5831" class="Bound">v</a><a id="5933" class="Symbol">)</a>
  <a id="5937" href="/Soundness/#5895" class="Function">sub-z-ok</a> <a id="5946" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="5948" class="Symbol">=</a> <a id="5950" href="plfa.Soundness.html#5840" class="Bound">dm</a>
  <a id="5955" href="/Soundness/#5895" class="Function">sub-z-ok</a> <a id="5964" class="Symbol">(</a><a id="5965" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="5967" href="plfa.Soundness.html#5967" class="Bound">x</a><a id="5968" class="Symbol">)</a> <a id="5970" class="Symbol">=</a> <a id="5972" href="/Denotational/#9337" class="InductiveConstructor">var</a>
</pre>
<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6649" href="/Soundness/#6649" class="Function">preserve</a> <a id="6658" class="Symbol">:</a> <a id="6660" class="Symbol">∀</a> <a id="6662" class="Symbol">{</a><a id="6663" href="plfa.Soundness.html#6663" class="Bound">Γ</a><a id="6664" class="Symbol">}</a> <a id="6666" class="Symbol">{</a><a id="6667" href="plfa.Soundness.html#6667" class="Bound">γ</a> <a id="6669" class="Symbol">:</a> <a id="6671" href="/Denotational/#7109" class="Function">Env</a> <a id="6675" href="plfa.Soundness.html#6663" class="Bound">Γ</a><a id="6676" class="Symbol">}</a> <a id="6678" class="Symbol">{</a><a id="6679" href="plfa.Soundness.html#6679" class="Bound">M</a> <a id="6681" href="plfa.Soundness.html#6681" class="Bound">N</a> <a id="6683" href="plfa.Soundness.html#6683" class="Bound">v</a><a id="6684" class="Symbol">}</a>
  <a id="6688" class="Symbol">→</a> <a id="6690" href="/Soundness/#6667" class="Bound">γ</a> <a id="6692" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="6694" href="plfa.Soundness.html#6679" class="Bound">M</a> <a id="6696" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="6698" href="plfa.Soundness.html#6683" class="Bound">v</a>
  <a id="6702" class="Symbol">→</a> <a id="6704" href="/Soundness/#6679" class="Bound">M</a> <a id="6706" href="/Untyped/#10105" class="Datatype Operator">—→</a> <a id="6709" href="plfa.Soundness.html#6681" class="Bound">N</a>
    <a id="6715" class="Comment">----------</a>
  <a id="6728" class="Symbol">→</a> <a id="6730" href="/Soundness/#6667" class="Bound">γ</a> <a id="6732" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="6734" href="plfa.Soundness.html#6681" class="Bound">N</a> <a id="6736" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="6738" href="plfa.Soundness.html#6683" class="Bound">v</a>
<a id="6740" href="/Soundness/#6649" class="Function">preserve</a> <a id="6749" class="Symbol">(</a><a id="6750" href="/Denotational/#9337" class="InductiveConstructor">var</a><a id="6753" class="Symbol">)</a> <a id="6755" class="Symbol">()</a>
<a id="6758" href="/Soundness/#6649" class="Function">preserve</a> <a id="6767" class="Symbol">(</a><a id="6768" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="6775" href="plfa.Soundness.html#6775" class="Bound">d₁</a> <a id="6778" href="plfa.Soundness.html#6778" class="Bound">d₂</a><a id="6780" class="Symbol">)</a> <a id="6782" class="Symbol">(</a><a id="6783" href="/Untyped/#10155" class="InductiveConstructor">ξ₁</a> <a id="6786" href="plfa.Soundness.html#6786" class="Bound">r</a><a id="6787" class="Symbol">)</a> <a id="6789" class="Symbol">=</a> <a id="6791" href="plfa.Denotational.html#9416" class="InductiveConstructor">↦-elim</a> <a id="6798" class="Symbol">(</a><a id="6799" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="6808" href="plfa.Soundness.html#6775" class="Bound">d₁</a> <a id="6811" href="plfa.Soundness.html#6786" class="Bound">r</a><a id="6812" class="Symbol">)</a> <a id="6814" href="plfa.Soundness.html#6778" class="Bound">d₂</a>
<a id="6817" href="/Soundness/#6649" class="Function">preserve</a> <a id="6826" class="Symbol">(</a><a id="6827" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="6834" href="plfa.Soundness.html#6834" class="Bound">d₁</a> <a id="6837" href="plfa.Soundness.html#6837" class="Bound">d₂</a><a id="6839" class="Symbol">)</a> <a id="6841" class="Symbol">(</a><a id="6842" href="/Untyped/#10245" class="InductiveConstructor">ξ₂</a> <a id="6845" href="plfa.Soundness.html#6845" class="Bound">r</a><a id="6846" class="Symbol">)</a> <a id="6848" class="Symbol">=</a> <a id="6850" href="plfa.Denotational.html#9416" class="InductiveConstructor">↦-elim</a> <a id="6857" href="plfa.Soundness.html#6834" class="Bound">d₁</a> <a id="6860" class="Symbol">(</a><a id="6861" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="6870" href="plfa.Soundness.html#6837" class="Bound">d₂</a> <a id="6873" href="plfa.Soundness.html#6845" class="Bound">r</a><a id="6874" class="Symbol">)</a>
<a id="6876" href="/Soundness/#6649" class="Function">preserve</a> <a id="6885" class="Symbol">(</a><a id="6886" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="6893" href="plfa.Soundness.html#6893" class="Bound">d₁</a> <a id="6896" href="plfa.Soundness.html#6896" class="Bound">d₂</a><a id="6898" class="Symbol">)</a> <a id="6900" href="/Untyped/#10335" class="InductiveConstructor">β</a> <a id="6902" class="Symbol">=</a> <a id="6904" href="plfa.Soundness.html#5686" class="Function">substitution</a> <a id="6917" class="Symbol">(</a><a id="6918" href="/Compositional/#3566" class="Function">lambda-inversion</a> <a id="6935" href="plfa.Soundness.html#6893" class="Bound">d₁</a><a id="6937" class="Symbol">)</a> <a id="6939" href="plfa.Soundness.html#6896" class="Bound">d₂</a>
<a id="6942" href="/Soundness/#6649" class="Function">preserve</a> <a id="6951" class="Symbol">(</a><a id="6952" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="6960" href="plfa.Soundness.html#6960" class="Bound">d</a><a id="6961" class="Symbol">)</a> <a id="6963" class="Symbol">(</a><a id="6964" href="/Untyped/#10443" class="InductiveConstructor">ζ</a> <a id="6966" href="plfa.Soundness.html#6966" class="Bound">r</a><a id="6967" class="Symbol">)</a> <a id="6969" class="Symbol">=</a> <a id="6971" href="plfa.Denotational.html#9554" class="InductiveConstructor">↦-intro</a> <a id="6979" class="Symbol">(</a><a id="6980" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="6989" href="plfa.Soundness.html#6960" class="Bound">d</a> <a id="6991" href="plfa.Soundness.html#6966" class="Bound">r</a><a id="6992" class="Symbol">)</a>
<a id="6994" href="/Soundness/#6649" class="Function">preserve</a> <a id="7003" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="7011" href="plfa.Soundness.html#7011" class="Bound">r</a> <a id="7013" class="Symbol">=</a> <a id="7015" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a>
<a id="7023" href="/Soundness/#6649" class="Function">preserve</a> <a id="7032" class="Symbol">(</a><a id="7033" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="7041" href="plfa.Soundness.html#7041" class="Bound">d</a> <a id="7043" href="plfa.Soundness.html#7043" class="Bound">d₁</a><a id="7045" class="Symbol">)</a> <a id="7047" href="plfa.Soundness.html#7047" class="Bound">r</a> <a id="7049" class="Symbol">=</a> <a id="7051" href="plfa.Denotational.html#9753" class="InductiveConstructor">⊔-intro</a> <a id="7059" class="Symbol">(</a><a id="7060" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="7069" href="plfa.Soundness.html#7041" class="Bound">d</a> <a id="7071" href="plfa.Soundness.html#7047" class="Bound">r</a><a id="7072" class="Symbol">)</a> <a id="7074" class="Symbol">(</a><a id="7075" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="7084" href="plfa.Soundness.html#7043" class="Bound">d₁</a> <a id="7087" href="plfa.Soundness.html#7047" class="Bound">r</a><a id="7088" class="Symbol">)</a>
<a id="7090" href="/Soundness/#6649" class="Function">preserve</a> <a id="7099" class="Symbol">(</a><a id="7100" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="7104" href="plfa.Soundness.html#7104" class="Bound">d</a> <a id="7106" href="plfa.Soundness.html#7106" class="Bound">lt</a><a id="7108" class="Symbol">)</a> <a id="7110" href="plfa.Soundness.html#7110" class="Bound">r</a> <a id="7112" class="Symbol">=</a> <a id="7114" href="plfa.Denotational.html#9884" class="InductiveConstructor">sub</a> <a id="7118" class="Symbol">(</a><a id="7119" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="7128" href="plfa.Soundness.html#7104" class="Bound">d</a> <a id="7130" href="plfa.Soundness.html#7110" class="Bound">r</a><a id="7131" class="Symbol">)</a> <a id="7133" href="plfa.Soundness.html#7106" class="Bound">lt</a>
</pre>
<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8823" href="/Soundness/#8823" class="Function">nth-ext</a> <a id="8831" class="Symbol">:</a> <a id="8833" class="Symbol">∀</a> <a id="8835" class="Symbol">{</a><a id="8836" href="plfa.Soundness.html#8836" class="Bound">Γ</a> <a id="8838" href="plfa.Soundness.html#8838" class="Bound">Δ</a> <a id="8840" href="plfa.Soundness.html#8840" class="Bound">v</a><a id="8841" class="Symbol">}</a> <a id="8843" class="Symbol">{</a><a id="8844" href="plfa.Soundness.html#8844" class="Bound">γ</a> <a id="8846" class="Symbol">:</a> <a id="8848" href="/Denotational/#7109" class="Function">Env</a> <a id="8852" href="plfa.Soundness.html#8836" class="Bound">Γ</a><a id="8853" class="Symbol">}</a> <a id="8855" class="Symbol">{</a><a id="8856" href="plfa.Soundness.html#8856" class="Bound">δ</a> <a id="8858" class="Symbol">:</a> <a id="8860" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="8864" href="plfa.Soundness.html#8838" class="Bound">Δ</a><a id="8865" class="Symbol">}</a>
  <a id="8869" class="Symbol">→</a> <a id="8871" class="Symbol">(</a><a id="8872" href="/Soundness/#8872" class="Bound">ρ</a> <a id="8874" class="Symbol">:</a> <a id="8876" href="/Substitution/#2247" class="Function">Rename</a> <a id="8883" href="plfa.Soundness.html#8836" class="Bound">Γ</a> <a id="8885" href="plfa.Soundness.html#8838" class="Bound">Δ</a><a id="8886" class="Symbol">)</a>
  <a id="8890" class="Symbol">→</a> <a id="8892" class="Symbol">(</a><a id="8893" href="/Soundness/#8856" class="Bound">δ</a> <a id="8895" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8897" href="plfa.Soundness.html#8872" class="Bound">ρ</a><a id="8898" class="Symbol">)</a> <a id="8900" href="/Denotational/#8071" class="Function Operator">`⊑</a> <a id="8903" href="plfa.Soundness.html#8844" class="Bound">γ</a>
    <a id="8909" class="Comment">------------------------------</a>
  <a id="8942" class="Symbol">→</a> <a id="8944" class="Symbol">((</a><a id="8946" href="/Soundness/#8856" class="Bound">δ</a> <a id="8948" href="/Denotational/#7266" class="Function Operator">`,</a> <a id="8951" href="plfa.Soundness.html#8840" class="Bound">v</a><a id="8952" class="Symbol">)</a> <a id="8954" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="8956" href="/Untyped/#5883" class="Function">ext</a> <a id="8960" href="plfa.Soundness.html#8872" class="Bound">ρ</a><a id="8961" class="Symbol">)</a> <a id="8963" href="plfa.Denotational.html#8071" class="Function Operator">`⊑</a> <a id="8966" class="Symbol">(</a><a id="8967" href="plfa.Soundness.html#8844" class="Bound">γ</a> <a id="8969" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="8972" href="plfa.Soundness.html#8840" class="Bound">v</a><a id="8973" class="Symbol">)</a>
<a id="8975" href="/Soundness/#8823" class="Function">nth-ext</a> <a id="8983" href="plfa.Soundness.html#8983" class="Bound">ρ</a> <a id="8985" href="plfa.Soundness.html#8985" class="Bound">lt</a> <a id="8988" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="8990" class="Symbol">=</a> <a id="8992" href="/Denotational/#5480" class="Function">Refl⊑</a>
<a id="8998" href="/Soundness/#8823" class="Function">nth-ext</a> <a id="9006" href="plfa.Soundness.html#9006" class="Bound">ρ</a> <a id="9008" href="plfa.Soundness.html#9008" class="Bound">lt</a> <a id="9011" class="Symbol">(</a><a id="9012" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="9014" href="plfa.Soundness.html#9014" class="Bound">x</a><a id="9015" class="Symbol">)</a> <a id="9017" class="Symbol">=</a> <a id="9019" href="plfa.Soundness.html#9008" class="Bound">lt</a> <a id="9022" href="plfa.Soundness.html#9014" class="Bound">x</a>
</pre>
<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9063" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9078" class="Symbol">:</a> <a id="9080" class="Symbol">∀</a> <a id="9082" class="Symbol">{</a><a id="9083" href="plfa.Soundness.html#9083" class="Bound">Γ</a> <a id="9085" href="plfa.Soundness.html#9085" class="Bound">Δ</a> <a id="9087" href="plfa.Soundness.html#9087" class="Bound">v</a><a id="9088" class="Symbol">}</a> <a id="9090" class="Symbol">{</a><a id="9091" href="plfa.Soundness.html#9091" class="Bound">γ</a> <a id="9093" class="Symbol">:</a> <a id="9095" href="/Denotational/#7109" class="Function">Env</a> <a id="9099" href="plfa.Soundness.html#9083" class="Bound">Γ</a><a id="9100" class="Symbol">}</a> <a id="9102" class="Symbol">{</a><a id="9103" href="plfa.Soundness.html#9103" class="Bound">δ</a> <a id="9105" class="Symbol">:</a> <a id="9107" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="9111" href="plfa.Soundness.html#9085" class="Bound">Δ</a><a id="9112" class="Symbol">}</a> <a id="9114" class="Symbol">{</a> <a id="9116" href="plfa.Soundness.html#9116" class="Bound">M</a> <a id="9118" class="Symbol">:</a> <a id="9120" href="plfa.Soundness.html#9083" class="Bound">Γ</a> <a id="9122" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="9124" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="9125" class="Symbol">}</a>
  <a id="9129" class="Symbol">→</a> <a id="9131" class="Symbol">{</a><a id="9132" href="/Soundness/#9132" class="Bound">ρ</a> <a id="9134" class="Symbol">:</a> <a id="9136" href="/Substitution/#2247" class="Function">Rename</a> <a id="9143" href="plfa.Soundness.html#9083" class="Bound">Γ</a> <a id="9145" href="plfa.Soundness.html#9085" class="Bound">Δ</a><a id="9146" class="Symbol">}</a>
  <a id="9150" class="Symbol">→</a> <a id="9152" class="Symbol">(</a><a id="9153" href="/Soundness/#9103" class="Bound">δ</a> <a id="9155" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">∘</a> <a id="9157" href="plfa.Soundness.html#9132" class="Bound">ρ</a><a id="9158" class="Symbol">)</a> <a id="9160" href="/Denotational/#8071" class="Function Operator">`⊑</a> <a id="9163" href="plfa.Soundness.html#9091" class="Bound">γ</a>
  <a id="9167" class="Symbol">→</a> <a id="9169" href="/Soundness/#9103" class="Bound">δ</a> <a id="9171" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="9173" href="/Untyped/#6193" class="Function">rename</a> <a id="9180" href="plfa.Soundness.html#9132" class="Bound">ρ</a> <a id="9182" href="plfa.Soundness.html#9116" class="Bound">M</a> <a id="9184" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="9186" href="plfa.Soundness.html#9087" class="Bound">v</a>
    <a id="9192" class="Comment">------------------------------------</a>
  <a id="9231" class="Symbol">→</a> <a id="9233" href="/Soundness/#9091" class="Bound">γ</a> <a id="9235" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="9237" href="plfa.Soundness.html#9116" class="Bound">M</a> <a id="9239" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="9241" href="plfa.Soundness.html#9087" class="Bound">v</a>
<a id="9243" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9258" class="Symbol">{</a><a id="9259" class="Argument">M</a> <a id="9261" class="Symbol">=</a> <a id="9263" href="/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="9265" href="plfa.Soundness.html#9265" class="Bound">x</a><a id="9266" class="Symbol">}</a> <a id="9268" href="plfa.Soundness.html#9268" class="Bound">all-n</a> <a id="9274" href="plfa.Soundness.html#9274" class="Bound">d</a> <a id="9276" class="Keyword">with</a> <a id="9281" href="/Compositional/#9665" class="Function">var-inv</a> <a id="9289" href="plfa.Soundness.html#9274" class="Bound">d</a>
<a id="9291" class="Symbol">...</a> <a id="9295" class="Symbol">|</a> <a id="9297" href="/Soundness/#9297" class="Bound">lt</a> <a id="9300" class="Symbol">=</a>  <a id="9303" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="9307" href="plfa.Denotational.html#9337" class="InductiveConstructor">var</a> <a id="9311" class="Symbol">(</a><a id="9312" href="plfa.Denotational.html#4623" class="InductiveConstructor">Trans⊑</a> <a id="9319" href="plfa.Soundness.html#9297" class="Bound">lt</a> <a id="9322" class="Symbol">(</a><a id="9323" class="Bound">all-n</a> <a id="9329" class="Bound">x</a><a id="9330" class="Symbol">))</a>
<a id="9333" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9348" class="Symbol">{</a><a id="9349" class="Argument">M</a> <a id="9351" class="Symbol">=</a> <a id="9353" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9355" href="plfa.Soundness.html#9355" class="Bound">N</a><a id="9356" class="Symbol">}{</a><a id="9358" class="Argument">ρ</a> <a id="9360" class="Symbol">=</a> <a id="9362" href="plfa.Soundness.html#9362" class="Bound">ρ</a><a id="9363" class="Symbol">}</a> <a id="9365" href="plfa.Soundness.html#9365" class="Bound">all-n</a> <a id="9371" class="Symbol">(</a><a id="9372" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="9380" href="plfa.Soundness.html#9380" class="Bound">d</a><a id="9381" class="Symbol">)</a> <a id="9383" class="Symbol">=</a>
   <a id="9388" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="9396" class="Symbol">(</a><a id="9397" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9412" class="Symbol">(</a><a id="9413" href="plfa.Soundness.html#8823" class="Function">nth-ext</a> <a id="9421" href="plfa.Soundness.html#9362" class="Bound">ρ</a> <a id="9423" href="plfa.Soundness.html#9365" class="Bound">all-n</a><a id="9428" class="Symbol">)</a> <a id="9430" href="plfa.Soundness.html#9380" class="Bound">d</a><a id="9431" class="Symbol">)</a>
<a id="9433" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9448" class="Symbol">{</a><a id="9449" class="Argument">M</a> <a id="9451" class="Symbol">=</a> <a id="9453" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9455" href="plfa.Soundness.html#9455" class="Bound">N</a><a id="9456" class="Symbol">}</a> <a id="9458" href="plfa.Soundness.html#9458" class="Bound">all-n</a> <a id="9464" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="9472" class="Symbol">=</a> <a id="9474" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a>
<a id="9482" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9497" class="Symbol">{</a><a id="9498" class="Argument">M</a> <a id="9500" class="Symbol">=</a> <a id="9502" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9504" href="plfa.Soundness.html#9504" class="Bound">N</a><a id="9505" class="Symbol">}</a> <a id="9507" href="plfa.Soundness.html#9507" class="Bound">all-n</a> <a id="9513" class="Symbol">(</a><a id="9514" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="9522" href="plfa.Soundness.html#9522" class="Bound">d₁</a> <a id="9525" href="plfa.Soundness.html#9525" class="Bound">d₂</a><a id="9527" class="Symbol">)</a> <a id="9529" class="Symbol">=</a>
   <a id="9534" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="9542" class="Symbol">(</a><a id="9543" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9558" href="plfa.Soundness.html#9507" class="Bound">all-n</a> <a id="9564" href="plfa.Soundness.html#9522" class="Bound">d₁</a><a id="9566" class="Symbol">)</a> <a id="9568" class="Symbol">(</a><a id="9569" href="plfa.Soundness.html#9063" class="Function">rename-reflect</a> <a id="9584" href="plfa.Soundness.html#9507" class="Bound">all-n</a> <a id="9590" href="plfa.Soundness.html#9525" class="Bound">d₂</a><a id="9592" class="Symbol">)</a>
<a id="9594" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9609" class="Symbol">{</a><a id="9610" class="Argument">M</a> <a id="9612" class="Symbol">=</a> <a id="9614" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="9616" href="plfa.Soundness.html#9616" class="Bound">N</a><a id="9617" class="Symbol">}</a> <a id="9619" href="plfa.Soundness.html#9619" class="Bound">all-n</a> <a id="9625" class="Symbol">(</a><a id="9626" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="9630" href="plfa.Soundness.html#9630" class="Bound">d₁</a> <a id="9633" href="plfa.Soundness.html#9633" class="Bound">lt</a><a id="9635" class="Symbol">)</a> <a id="9637" class="Symbol">=</a>
   <a id="9642" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="9646" class="Symbol">(</a><a id="9647" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9662" href="plfa.Soundness.html#9619" class="Bound">all-n</a> <a id="9668" href="plfa.Soundness.html#9630" class="Bound">d₁</a><a id="9670" class="Symbol">)</a> <a id="9672" href="plfa.Soundness.html#9633" class="Bound">lt</a>
<a id="9675" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9690" class="Symbol">{</a><a id="9691" class="Argument">M</a> <a id="9693" class="Symbol">=</a> <a id="9695" href="plfa.Soundness.html#9695" class="Bound">L</a> <a id="9697" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9699" href="plfa.Soundness.html#9699" class="Bound">M</a><a id="9700" class="Symbol">}</a> <a id="9702" href="plfa.Soundness.html#9702" class="Bound">all-n</a> <a id="9708" class="Symbol">(</a><a id="9709" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="9716" href="plfa.Soundness.html#9716" class="Bound">d₁</a> <a id="9719" href="plfa.Soundness.html#9719" class="Bound">d₂</a><a id="9721" class="Symbol">)</a> <a id="9723" class="Symbol">=</a>
   <a id="9728" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="9735" class="Symbol">(</a><a id="9736" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9751" href="plfa.Soundness.html#9702" class="Bound">all-n</a> <a id="9757" href="plfa.Soundness.html#9716" class="Bound">d₁</a><a id="9759" class="Symbol">)</a> <a id="9761" class="Symbol">(</a><a id="9762" href="plfa.Soundness.html#9063" class="Function">rename-reflect</a> <a id="9777" href="plfa.Soundness.html#9702" class="Bound">all-n</a> <a id="9783" href="plfa.Soundness.html#9719" class="Bound">d₂</a><a id="9785" class="Symbol">)</a>
<a id="9787" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9802" class="Symbol">{</a><a id="9803" class="Argument">M</a> <a id="9805" class="Symbol">=</a> <a id="9807" href="plfa.Soundness.html#9807" class="Bound">L</a> <a id="9809" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9811" href="plfa.Soundness.html#9811" class="Bound">M</a><a id="9812" class="Symbol">}</a> <a id="9814" href="plfa.Soundness.html#9814" class="Bound">all-n</a> <a id="9820" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="9828" class="Symbol">=</a> <a id="9830" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a>
<a id="9838" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9853" class="Symbol">{</a><a id="9854" class="Argument">M</a> <a id="9856" class="Symbol">=</a> <a id="9858" href="plfa.Soundness.html#9858" class="Bound">L</a> <a id="9860" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9862" href="plfa.Soundness.html#9862" class="Bound">M</a><a id="9863" class="Symbol">}</a> <a id="9865" href="plfa.Soundness.html#9865" class="Bound">all-n</a> <a id="9871" class="Symbol">(</a><a id="9872" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="9880" href="plfa.Soundness.html#9880" class="Bound">d₁</a> <a id="9883" href="plfa.Soundness.html#9883" class="Bound">d₂</a><a id="9885" class="Symbol">)</a> <a id="9887" class="Symbol">=</a>
   <a id="9892" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="9900" class="Symbol">(</a><a id="9901" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9916" href="plfa.Soundness.html#9865" class="Bound">all-n</a> <a id="9922" href="plfa.Soundness.html#9880" class="Bound">d₁</a><a id="9924" class="Symbol">)</a> <a id="9926" class="Symbol">(</a><a id="9927" href="plfa.Soundness.html#9063" class="Function">rename-reflect</a> <a id="9942" href="plfa.Soundness.html#9865" class="Bound">all-n</a> <a id="9948" href="plfa.Soundness.html#9883" class="Bound">d₂</a><a id="9950" class="Symbol">)</a>
<a id="9952" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="9967" class="Symbol">{</a><a id="9968" class="Argument">M</a> <a id="9970" class="Symbol">=</a> <a id="9972" href="plfa.Soundness.html#9972" class="Bound">L</a> <a id="9974" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="9976" href="plfa.Soundness.html#9976" class="Bound">M</a><a id="9977" class="Symbol">}</a> <a id="9979" href="plfa.Soundness.html#9979" class="Bound">all-n</a> <a id="9985" class="Symbol">(</a><a id="9986" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="9990" href="plfa.Soundness.html#9990" class="Bound">d₁</a> <a id="9993" href="plfa.Soundness.html#9993" class="Bound">lt</a><a id="9995" class="Symbol">)</a> <a id="9997" class="Symbol">=</a>
   <a id="10002" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="10006" class="Symbol">(</a><a id="10007" href="/Soundness/#9063" class="Function">rename-reflect</a> <a id="10022" href="plfa.Soundness.html#9979" class="Bound">all-n</a> <a id="10028" href="plfa.Soundness.html#9990" class="Bound">d₁</a><a id="10030" class="Symbol">)</a> <a id="10032" href="plfa.Soundness.html#9993" class="Bound">lt</a>
</pre>
<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11197" href="/Soundness/#11197" class="Function">rename-inc-reflect</a> <a id="11216" class="Symbol">:</a> <a id="11218" class="Symbol">∀</a> <a id="11220" class="Symbol">{</a><a id="11221" href="plfa.Soundness.html#11221" class="Bound">Γ</a> <a id="11223" href="plfa.Soundness.html#11223" class="Bound">v′</a> <a id="11226" href="plfa.Soundness.html#11226" class="Bound">v</a><a id="11227" class="Symbol">}</a> <a id="11229" class="Symbol">{</a><a id="11230" href="plfa.Soundness.html#11230" class="Bound">γ</a> <a id="11232" class="Symbol">:</a> <a id="11234" href="/Denotational/#7109" class="Function">Env</a> <a id="11238" href="plfa.Soundness.html#11221" class="Bound">Γ</a><a id="11239" class="Symbol">}</a> <a id="11241" class="Symbol">{</a> <a id="11243" href="plfa.Soundness.html#11243" class="Bound">M</a> <a id="11245" class="Symbol">:</a> <a id="11247" href="plfa.Soundness.html#11221" class="Bound">Γ</a> <a id="11249" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="11251" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="11252" class="Symbol">}</a>
  <a id="11256" class="Symbol">→</a> <a id="11258" class="Symbol">(</a><a id="11259" href="/Soundness/#11230" class="Bound">γ</a> <a id="11261" href="/Denotational/#7266" class="Function Operator">`,</a> <a id="11264" href="plfa.Soundness.html#11223" class="Bound">v′</a><a id="11266" class="Symbol">)</a> <a id="11268" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="11270" href="/Untyped/#6193" class="Function">rename</a> <a id="11277" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S_</a> <a id="11280" href="plfa.Soundness.html#11243" class="Bound">M</a> <a id="11282" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="11284" href="plfa.Soundness.html#11226" class="Bound">v</a>
    <a id="11290" class="Comment">----------------------------</a>
  <a id="11321" class="Symbol">→</a> <a id="11323" href="/Soundness/#11230" class="Bound">γ</a> <a id="11325" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="11327" href="plfa.Soundness.html#11243" class="Bound">M</a> <a id="11329" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="11331" href="plfa.Soundness.html#11226" class="Bound">v</a>
<a id="11333" href="/Soundness/#11197" class="Function">rename-inc-reflect</a> <a id="11352" href="plfa.Soundness.html#11352" class="Bound">d</a> <a id="11354" class="Symbol">=</a> <a id="11356" href="plfa.Soundness.html#9063" class="Function">rename-reflect</a> <a id="11371" href="/Denotational/#8557" class="Function">`Refl⊑</a> <a id="11378" href="plfa.Soundness.html#11352" class="Bound">d</a>
</pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>. To tell variables apart, we
define the following function for deciding equality of variables.</p>

<pre class="Agda"><a id="_var≟_"></a><a id="12100" href="/Soundness/#12100" class="Function Operator">_var≟_</a> <a id="12107" class="Symbol">:</a> <a id="12109" class="Symbol">∀</a> <a id="12111" class="Symbol">{</a><a id="12112" href="plfa.Soundness.html#12112" class="Bound">Γ</a><a id="12113" class="Symbol">}</a> <a id="12115" class="Symbol">→</a> <a id="12117" class="Symbol">(</a><a id="12118" href="plfa.Soundness.html#12118" class="Bound">x</a> <a id="12120" href="plfa.Soundness.html#12120" class="Bound">y</a> <a id="12122" class="Symbol">:</a> <a id="12124" href="plfa.Soundness.html#12112" class="Bound">Γ</a> <a id="12126" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12128" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12129" class="Symbol">)</a> <a id="12131" class="Symbol">→</a> <a id="12133" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a> <a id="12137" class="Symbol">(</a><a id="12138" href="plfa.Soundness.html#12118" class="Bound">x</a> <a id="12140" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12142" href="plfa.Soundness.html#12120" class="Bound">y</a><a id="12143" class="Symbol">)</a>
<a id="12145" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="12147" href="/Soundness/#12100" class="Function Operator">var≟</a> <a id="12152" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>  <a id="12155" class="Symbol">=</a>  <a id="12158" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12162" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12167" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="12169" href="/Soundness/#12100" class="Function Operator">var≟</a> <a id="12174" class="Symbol">(</a><a id="12175" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="12177" class="Symbol">_)</a>  <a id="12181" class="Symbol">=</a>  <a id="12184" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12187" class="Symbol">λ()</a>
<a id="12191" class="Symbol">(</a><a id="12192" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="12194" class="Symbol">_)</a> <a id="12197" href="/Soundness/#12100" class="Function Operator">var≟</a> <a id="12202" href="plfa.Untyped.html#3519" class="InductiveConstructor">Z</a>  <a id="12205" class="Symbol">=</a>  <a id="12208" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12211" class="Symbol">λ()</a>
<a id="12215" class="Symbol">(</a><a id="12216" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="12218" href="/Soundness/#12218" class="Bound">x</a><a id="12219" class="Symbol">)</a> <a id="12221" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="12226" class="Symbol">(</a><a id="12227" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="12229" href="plfa.Soundness.html#12229" class="Bound">y</a><a id="12230" class="Symbol">)</a> <a id="12232" class="Keyword">with</a>  <a id="12238" href="plfa.Soundness.html#12218" class="Bound">x</a> <a id="12240" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="12245" href="plfa.Soundness.html#12229" class="Bound">y</a>
<a id="12247" class="Symbol">...</a>                 <a id="12267" class="Symbol">|</a>  <a id="12270" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12274" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12279" class="Symbol">=</a>  <a id="12282" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12286" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12291" class="Symbol">...</a>                 <a id="12311" class="Symbol">|</a>  <a id="12314" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12317" href="/Soundness/#12317" class="Bound">neq</a>   <a id="12323" class="Symbol">=</a>  <a id="12326" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12329" class="Symbol">λ{</a><a id="12331" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12336" class="Symbol">→</a> <a id="12338" href="plfa.Soundness.html#12317" class="Bound">neq</a> <a id="12342" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="12346" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12349" href="/Soundness/#12349" class="Function">var≟-refl</a> <a id="12359" class="Symbol">:</a> <a id="12361" class="Symbol">∀</a> <a id="12363" class="Symbol">{</a><a id="12364" href="plfa.Soundness.html#12364" class="Bound">Γ</a><a id="12365" class="Symbol">}</a> <a id="12367" class="Symbol">(</a><a id="12368" href="plfa.Soundness.html#12368" class="Bound">x</a> <a id="12370" class="Symbol">:</a> <a id="12372" href="plfa.Soundness.html#12364" class="Bound">Γ</a> <a id="12374" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12376" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12377" class="Symbol">)</a> <a id="12379" class="Symbol">→</a> <a id="12381" class="Symbol">(</a><a id="12382" href="plfa.Soundness.html#12368" class="Bound">x</a> <a id="12384" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="12389" href="plfa.Soundness.html#12368" class="Bound">x</a><a id="12390" class="Symbol">)</a> <a id="12392" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12394" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12398" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12403" href="/Soundness/#12349" class="Function">var≟-refl</a> <a id="12413" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="12415" class="Symbol">=</a> <a id="12417" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12422" href="/Soundness/#12349" class="Function">var≟-refl</a> <a id="12432" class="Symbol">(</a><a id="12433" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="12435" href="plfa.Soundness.html#12435" class="Bound">x</a><a id="12436" class="Symbol">)</a> <a id="12438" class="Keyword">rewrite</a> <a id="12446" href="plfa.Soundness.html#12349" class="Function">var≟-refl</a> <a id="12456" href="plfa.Soundness.html#12435" class="Bound">x</a> <a id="12458" class="Symbol">=</a> <a id="12460" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>Now we use <code class="highlighter-rouge">var≟</code> to define <code class="highlighter-rouge">const-env</code>.</p>

<pre class="Agda"><a id="const-env"></a><a id="12516" href="/Soundness/#12516" class="Function">const-env</a> <a id="12526" class="Symbol">:</a> <a id="12528" class="Symbol">∀{</a><a id="12530" href="plfa.Soundness.html#12530" class="Bound">Γ</a><a id="12531" class="Symbol">}</a> <a id="12533" class="Symbol">→</a> <a id="12535" class="Symbol">(</a><a id="12536" href="plfa.Soundness.html#12536" class="Bound">x</a> <a id="12538" class="Symbol">:</a> <a id="12540" href="plfa.Soundness.html#12530" class="Bound">Γ</a> <a id="12542" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12544" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12545" class="Symbol">)</a> <a id="12547" class="Symbol">→</a> <a id="12549" href="/Denotational/#3971" class="Datatype">Value</a> <a id="12555" class="Symbol">→</a> <a id="12557" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="12561" href="plfa.Soundness.html#12530" class="Bound">Γ</a>
<a id="12563" href="/Soundness/#12516" class="Function">const-env</a> <a id="12573" href="plfa.Soundness.html#12573" class="Bound">x</a> <a id="12575" href="plfa.Soundness.html#12575" class="Bound">v</a> <a id="12577" href="plfa.Soundness.html#12577" class="Bound">y</a> <a id="12579" class="Keyword">with</a> <a id="12584" href="plfa.Soundness.html#12573" class="Bound">x</a> <a id="12586" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="12591" href="plfa.Soundness.html#12577" class="Bound">y</a>
<a id="12593" class="Symbol">...</a>             <a id="12609" class="Symbol">|</a> <a id="12611" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12615" class="Symbol">_</a>       <a id="12623" class="Symbol">=</a> <a id="12625" class="Bound">v</a>
<a id="12627" class="Symbol">...</a>             <a id="12643" class="Symbol">|</a> <a id="12645" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12648" class="Symbol">_</a>        <a id="12657" class="Symbol">=</a> <a id="12659" href="/Denotational/#3991" class="InductiveConstructor">⊥</a>
</pre>
<p>Of course, <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">x</code> to value <code class="highlighter-rouge">v</code></p>

<pre class="Agda"><a id="same-const-env"></a><a id="12720" href="/Soundness/#12720" class="Function">same-const-env</a> <a id="12735" class="Symbol">:</a> <a id="12737" class="Symbol">∀{</a><a id="12739" href="plfa.Soundness.html#12739" class="Bound">Γ</a><a id="12740" class="Symbol">}</a> <a id="12742" class="Symbol">{</a><a id="12743" href="plfa.Soundness.html#12743" class="Bound">x</a> <a id="12745" class="Symbol">:</a> <a id="12747" href="plfa.Soundness.html#12739" class="Bound">Γ</a> <a id="12749" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12751" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12752" class="Symbol">}</a> <a id="12754" class="Symbol">{</a><a id="12755" href="plfa.Soundness.html#12755" class="Bound">v</a><a id="12756" class="Symbol">}</a> <a id="12758" class="Symbol">→</a> <a id="12760" class="Symbol">(</a><a id="12761" href="plfa.Soundness.html#12516" class="Function">const-env</a> <a id="12771" href="plfa.Soundness.html#12743" class="Bound">x</a> <a id="12773" href="plfa.Soundness.html#12755" class="Bound">v</a><a id="12774" class="Symbol">)</a> <a id="12776" href="plfa.Soundness.html#12743" class="Bound">x</a> <a id="12778" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12780" href="plfa.Soundness.html#12755" class="Bound">v</a>
<a id="12782" href="/Soundness/#12720" class="Function">same-const-env</a> <a id="12797" class="Symbol">{</a><a id="12798" class="Argument">x</a> <a id="12800" class="Symbol">=</a> <a id="12802" href="plfa.Soundness.html#12802" class="Bound">x</a><a id="12803" class="Symbol">}</a> <a id="12805" class="Keyword">rewrite</a> <a id="12813" href="plfa.Soundness.html#12349" class="Function">var≟-refl</a> <a id="12823" href="plfa.Soundness.html#12802" class="Bound">x</a> <a id="12825" class="Symbol">=</a> <a id="12827" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>and <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">y</code> to <code class="highlighter-rouge">⊥, so long as </code>x ≢ y`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12898" href="/Soundness/#12898" class="Function">diff-nth-const-env</a> <a id="12917" class="Symbol">:</a> <a id="12919" class="Symbol">∀{</a><a id="12921" href="plfa.Soundness.html#12921" class="Bound">Γ</a><a id="12922" class="Symbol">}</a> <a id="12924" class="Symbol">{</a><a id="12925" href="plfa.Soundness.html#12925" class="Bound">x</a> <a id="12927" href="plfa.Soundness.html#12927" class="Bound">y</a> <a id="12929" class="Symbol">:</a> <a id="12931" href="plfa.Soundness.html#12921" class="Bound">Γ</a> <a id="12933" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="12935" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="12936" class="Symbol">}</a> <a id="12938" class="Symbol">{</a><a id="12939" href="plfa.Soundness.html#12939" class="Bound">v</a><a id="12940" class="Symbol">}</a>
  <a id="12944" class="Symbol">→</a> <a id="12946" href="/Soundness/#12925" class="Bound">x</a> <a id="12948" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">≢</a> <a id="12950" href="plfa.Soundness.html#12927" class="Bound">y</a>
    <a id="12956" class="Comment">-------------------</a>
  <a id="12978" class="Symbol">→</a> <a id="12980" href="/Soundness/#12516" class="Function">const-env</a> <a id="12990" href="plfa.Soundness.html#12925" class="Bound">x</a> <a id="12992" href="plfa.Soundness.html#12939" class="Bound">v</a> <a id="12994" href="plfa.Soundness.html#12927" class="Bound">y</a> <a id="12996" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="12998" href="/Denotational/#3991" class="InductiveConstructor">⊥</a>
<a id="13000" href="/Soundness/#12898" class="Function">diff-nth-const-env</a> <a id="13019" class="Symbol">{</a><a id="13020" href="plfa.Soundness.html#13020" class="Bound">Γ</a><a id="13021" class="Symbol">}</a> <a id="13023" class="Symbol">{</a><a id="13024" href="plfa.Soundness.html#13024" class="Bound">x</a><a id="13025" class="Symbol">}</a> <a id="13027" class="Symbol">{</a><a id="13028" href="plfa.Soundness.html#13028" class="Bound">y</a><a id="13029" class="Symbol">}</a> <a id="13031" href="plfa.Soundness.html#13031" class="Bound">neq</a> <a id="13035" class="Keyword">with</a> <a id="13040" href="plfa.Soundness.html#13024" class="Bound">x</a> <a id="13042" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="13047" href="plfa.Soundness.html#13028" class="Bound">y</a>
<a id="13049" class="Symbol">...</a>  <a id="13054" class="Symbol">|</a> <a id="13056" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="13060" href="/Soundness/#13060" class="Bound">eq</a>  <a id="13064" class="Symbol">=</a>  <a id="13067" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="13074" class="Symbol">(</a><a id="13075" class="Bound">neq</a> <a id="13079" href="plfa.Soundness.html#13060" class="Bound">eq</a><a id="13081" class="Symbol">)</a>
<a id="13083" class="Symbol">...</a>  <a id="13088" class="Symbol">|</a> <a id="13090" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="13093" class="Symbol">_</a>    <a id="13098" class="Symbol">=</a>  <a id="13101" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="13757" href="/Soundness/#13757" class="Function">subst-reflect-var</a> <a id="13775" class="Symbol">:</a> <a id="13777" class="Symbol">∀</a> <a id="13779" class="Symbol">{</a><a id="13780" href="plfa.Soundness.html#13780" class="Bound">Γ</a> <a id="13782" href="plfa.Soundness.html#13782" class="Bound">Δ</a><a id="13783" class="Symbol">}</a> <a id="13785" class="Symbol">{</a><a id="13786" href="plfa.Soundness.html#13786" class="Bound">γ</a> <a id="13788" class="Symbol">:</a> <a id="13790" href="/Denotational/#7109" class="Function">Env</a> <a id="13794" href="plfa.Soundness.html#13782" class="Bound">Δ</a><a id="13795" class="Symbol">}</a> <a id="13797" class="Symbol">{</a><a id="13798" href="plfa.Soundness.html#13798" class="Bound">x</a> <a id="13800" class="Symbol">:</a> <a id="13802" href="plfa.Soundness.html#13780" class="Bound">Γ</a> <a id="13804" href="/Untyped/#3483" class="Datatype Operator">∋</a> <a id="13806" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="13807" class="Symbol">}</a> <a id="13809" class="Symbol">{</a><a id="13810" href="plfa.Soundness.html#13810" class="Bound">v</a><a id="13811" class="Symbol">}</a> <a id="13813" class="Symbol">{</a><a id="13814" href="plfa.Soundness.html#13814" class="Bound">σ</a> <a id="13816" class="Symbol">:</a> <a id="13818" href="/Substitution/#2460" class="Function">Subst</a> <a id="13824" href="plfa.Soundness.html#13780" class="Bound">Γ</a> <a id="13826" href="plfa.Soundness.html#13782" class="Bound">Δ</a><a id="13827" class="Symbol">}</a>
  <a id="13831" class="Symbol">→</a> <a id="13833" href="/Soundness/#13786" class="Bound">γ</a> <a id="13835" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="13837" href="plfa.Soundness.html#13814" class="Bound">σ</a> <a id="13839" href="plfa.Soundness.html#13798" class="Bound">x</a> <a id="13841" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="13843" href="plfa.Soundness.html#13810" class="Bound">v</a>
    <a id="13849" class="Comment">-----------------------------------------</a>
  <a id="13893" class="Symbol">→</a> <a id="13895" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="13898" href="/Soundness/#13898" class="Bound">δ</a> <a id="13900" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="13902" href="/Denotational/#7109" class="Function">Env</a> <a id="13906" href="plfa.Soundness.html#13780" class="Bound">Γ</a> <a id="13908" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="13910" href="plfa.Soundness.html#13786" class="Bound">γ</a> <a id="13912" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="13915" href="plfa.Soundness.html#13814" class="Bound">σ</a> <a id="13917" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="13919" href="plfa.Soundness.html#13898" class="Bound">δ</a>  <a id="13922" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="13925" href="plfa.Soundness.html#13898" class="Bound">δ</a> <a id="13927" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="13929" href="/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="13931" href="plfa.Soundness.html#13798" class="Bound">x</a> <a id="13933" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="13935" href="plfa.Soundness.html#13810" class="Bound">v</a>
<a id="13937" href="/Soundness/#13757" class="Function">subst-reflect-var</a> <a id="13955" class="Symbol">{</a><a id="13956" href="plfa.Soundness.html#13956" class="Bound">Γ</a><a id="13957" class="Symbol">}{</a><a id="13959" href="plfa.Soundness.html#13959" class="Bound">Δ</a><a id="13960" class="Symbol">}{</a><a id="13962" href="plfa.Soundness.html#13962" class="Bound">γ</a><a id="13963" class="Symbol">}{</a><a id="13965" href="plfa.Soundness.html#13965" class="Bound">x</a><a id="13966" class="Symbol">}{</a><a id="13968" href="plfa.Soundness.html#13968" class="Bound">v</a><a id="13969" class="Symbol">}{</a><a id="13971" href="plfa.Soundness.html#13971" class="Bound">σ</a><a id="13972" class="Symbol">}</a> <a id="13974" href="plfa.Soundness.html#13974" class="Bound">xv</a>
  <a id="13979" class="Keyword">rewrite</a> <a id="13987" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="13991" class="Symbol">(</a><a id="13992" href="/Soundness/#12720" class="Function">same-const-env</a> <a id="14007" class="Symbol">{</a><a id="14008" href="plfa.Soundness.html#13956" class="Bound">Γ</a><a id="14009" class="Symbol">}{</a><a id="14011" href="plfa.Soundness.html#13965" class="Bound">x</a><a id="14012" class="Symbol">}{</a><a id="14014" href="plfa.Soundness.html#13968" class="Bound">v</a><a id="14015" class="Symbol">})</a> <a id="14018" class="Symbol">=</a>
    <a id="14024" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14026" href="/Soundness/#12516" class="Function">const-env</a> <a id="14036" href="plfa.Soundness.html#13965" class="Bound">x</a> <a id="14038" href="plfa.Soundness.html#13968" class="Bound">v</a> <a id="14040" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14042" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14044" href="plfa.Soundness.html#14077" class="Function">const-env-ok</a> <a id="14057" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14059" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="14063" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14065" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="14069" class="Keyword">where</a>
  <a id="14077" href="/Soundness/#14077" class="Function">const-env-ok</a> <a id="14090" class="Symbol">:</a> <a id="14092" href="plfa.Soundness.html#13962" class="Bound">γ</a> <a id="14094" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="14097" href="plfa.Soundness.html#13971" class="Bound">σ</a> <a id="14099" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="14101" href="plfa.Soundness.html#12516" class="Function">const-env</a> <a id="14111" href="plfa.Soundness.html#13965" class="Bound">x</a> <a id="14113" href="plfa.Soundness.html#13968" class="Bound">v</a>
  <a id="14117" href="/Soundness/#14077" class="Function">const-env-ok</a> <a id="14130" href="plfa.Soundness.html#14130" class="Bound">y</a> <a id="14132" class="Keyword">with</a> <a id="14137" href="plfa.Soundness.html#13965" class="Bound">x</a> <a id="14139" href="plfa.Soundness.html#12100" class="Function Operator">var≟</a> <a id="14144" href="plfa.Soundness.html#14130" class="Bound">y</a>
  <a id="14148" class="Symbol">...</a> <a id="14152" class="Symbol">|</a> <a id="14154" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="14158" href="/Soundness/#14158" class="Bound">x≡y</a> <a id="14162" class="Keyword">rewrite</a> <a id="14170" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14174" href="plfa.Soundness.html#14158" class="Bound">x≡y</a> <a id="14178" class="Symbol">|</a> <a id="14180" href="plfa.Soundness.html#12720" class="Function">same-const-env</a> <a id="14195" class="Symbol">{</a><a id="14196" href="plfa.Soundness.html#13956" class="Bound">Γ</a><a id="14197" class="Symbol">}{</a><a id="14199" href="plfa.Soundness.html#13965" class="Bound">x</a><a id="14200" class="Symbol">}{</a><a id="14202" href="plfa.Soundness.html#13968" class="Bound">v</a><a id="14203" class="Symbol">}</a> <a id="14205" class="Symbol">=</a> <a id="14207" href="plfa.Soundness.html#13974" class="Bound">xv</a>
  <a id="14212" class="Symbol">...</a> <a id="14216" class="Symbol">|</a> <a id="14218" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="14221" href="/Soundness/#14221" class="Bound">x≢y</a> <a id="14225" class="Keyword">rewrite</a> <a id="14233" href="plfa.Soundness.html#12898" class="Function">diff-nth-const-env</a> <a id="14252" class="Symbol">{</a><a id="14253" href="plfa.Soundness.html#13956" class="Bound">Γ</a><a id="14254" class="Symbol">}{</a><a id="14256" href="plfa.Soundness.html#13965" class="Bound">x</a><a id="14257" class="Symbol">}{</a><a id="14259" class="Bound">y</a><a id="14260" class="Symbol">}{</a><a id="14262" href="plfa.Soundness.html#13968" class="Bound">v</a><a id="14263" class="Symbol">}</a> <a id="14265" href="plfa.Soundness.html#14221" class="Bound">x≢y</a> <a id="14269" class="Symbol">=</a> <a id="14271" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a>
</pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14398" href="/Soundness/#14398" class="Function">subst-⊥</a> <a id="14406" class="Symbol">:</a> <a id="14408" class="Symbol">∀{</a><a id="14410" href="plfa.Soundness.html#14410" class="Bound">Γ</a> <a id="14412" href="plfa.Soundness.html#14412" class="Bound">Δ</a><a id="14413" class="Symbol">}{</a><a id="14415" href="plfa.Soundness.html#14415" class="Bound">γ</a> <a id="14417" class="Symbol">:</a> <a id="14419" href="/Denotational/#7109" class="Function">Env</a> <a id="14423" href="plfa.Soundness.html#14412" class="Bound">Δ</a><a id="14424" class="Symbol">}{</a><a id="14426" href="plfa.Soundness.html#14426" class="Bound">σ</a> <a id="14428" class="Symbol">:</a> <a id="14430" href="/Substitution/#2460" class="Function">Subst</a> <a id="14436" href="plfa.Soundness.html#14410" class="Bound">Γ</a> <a id="14438" href="plfa.Soundness.html#14412" class="Bound">Δ</a><a id="14439" class="Symbol">}</a>
    <a id="14445" class="Comment">-----------------</a>
  <a id="14465" class="Symbol">→</a> <a id="14467" href="/Soundness/#14415" class="Bound">γ</a> <a id="14469" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="14472" href="plfa.Soundness.html#14426" class="Bound">σ</a> <a id="14474" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="14476" href="/Denotational/#8274" class="Function">`⊥</a>
<a id="14479" href="/Soundness/#14398" class="Function">subst-⊥</a> <a id="14487" href="plfa.Soundness.html#14487" class="Bound">x</a> <a id="14489" class="Symbol">=</a> <a id="14491" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a>
</pre>
<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14652" href="/Soundness/#14652" class="Function">subst-⊔</a> <a id="14660" class="Symbol">:</a> <a id="14662" class="Symbol">∀{</a><a id="14664" href="plfa.Soundness.html#14664" class="Bound">Γ</a> <a id="14666" href="plfa.Soundness.html#14666" class="Bound">Δ</a><a id="14667" class="Symbol">}{</a><a id="14669" href="plfa.Soundness.html#14669" class="Bound">γ</a> <a id="14671" class="Symbol">:</a> <a id="14673" href="/Denotational/#7109" class="Function">Env</a> <a id="14677" href="plfa.Soundness.html#14666" class="Bound">Δ</a><a id="14678" class="Symbol">}{</a><a id="14680" href="plfa.Soundness.html#14680" class="Bound">γ₁</a> <a id="14683" href="plfa.Soundness.html#14683" class="Bound">γ₂</a> <a id="14686" class="Symbol">:</a> <a id="14688" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="14692" href="plfa.Soundness.html#14664" class="Bound">Γ</a><a id="14693" class="Symbol">}{</a><a id="14695" href="plfa.Soundness.html#14695" class="Bound">σ</a> <a id="14697" class="Symbol">:</a> <a id="14699" href="/Substitution/#2460" class="Function">Subst</a> <a id="14705" href="plfa.Soundness.html#14664" class="Bound">Γ</a> <a id="14707" href="plfa.Soundness.html#14666" class="Bound">Δ</a><a id="14708" class="Symbol">}</a>
           <a id="14721" class="Symbol">→</a> <a id="14723" href="/Soundness/#14669" class="Bound">γ</a> <a id="14725" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="14728" href="plfa.Soundness.html#14695" class="Bound">σ</a> <a id="14730" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="14732" href="plfa.Soundness.html#14680" class="Bound">γ₁</a>
           <a id="14746" class="Symbol">→</a> <a id="14748" href="/Soundness/#14669" class="Bound">γ</a> <a id="14750" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="14753" href="plfa.Soundness.html#14695" class="Bound">σ</a> <a id="14755" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="14757" href="plfa.Soundness.html#14683" class="Bound">γ₂</a>
             <a id="14773" class="Comment">-------------------------</a>
           <a id="14810" class="Symbol">→</a> <a id="14812" href="/Soundness/#14669" class="Bound">γ</a> <a id="14814" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="14817" href="plfa.Soundness.html#14695" class="Bound">σ</a> <a id="14819" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="14821" class="Symbol">(</a><a id="14822" href="plfa.Soundness.html#14680" class="Bound">γ₁</a> <a id="14825" href="/Denotational/#8303" class="Function Operator">`⊔</a> <a id="14828" href="plfa.Soundness.html#14683" class="Bound">γ₂</a><a id="14830" class="Symbol">)</a>
<a id="14832" href="/Soundness/#14652" class="Function">subst-⊔</a> <a id="14840" href="plfa.Soundness.html#14840" class="Bound">γ₁-ok</a> <a id="14846" href="plfa.Soundness.html#14846" class="Bound">γ₂-ok</a> <a id="14852" href="plfa.Soundness.html#14852" class="Bound">x</a> <a id="14854" class="Symbol">=</a> <a id="14856" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="14864" class="Symbol">(</a><a id="14865" href="plfa.Soundness.html#14840" class="Bound">γ₁-ok</a> <a id="14871" href="plfa.Soundness.html#14852" class="Bound">x</a><a id="14872" class="Symbol">)</a> <a id="14874" class="Symbol">(</a><a id="14875" href="plfa.Soundness.html#14846" class="Bound">γ₂-ok</a> <a id="14881" href="plfa.Soundness.html#14852" class="Bound">x</a><a id="14882" class="Symbol">)</a>
</pre>
<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="14934" href="/Soundness/#14934" class="Function">lambda-inj</a> <a id="14945" class="Symbol">:</a> <a id="14947" class="Symbol">∀</a> <a id="14949" class="Symbol">{</a><a id="14950" href="plfa.Soundness.html#14950" class="Bound">Γ</a><a id="14951" class="Symbol">}</a> <a id="14953" class="Symbol">{</a><a id="14954" href="plfa.Soundness.html#14954" class="Bound">M</a> <a id="14956" href="plfa.Soundness.html#14956" class="Bound">N</a> <a id="14958" class="Symbol">:</a> <a id="14960" href="plfa.Soundness.html#14950" class="Bound">Γ</a> <a id="14962" href="/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="14964" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="14966" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="14968" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="14970" class="Symbol">}</a>
  <a id="14974" class="Symbol">→</a> <a id="14976" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a> <a id="14980" class="Symbol">{</a><a id="14981" class="Argument">A</a> <a id="14983" class="Symbol">=</a> <a id="14985" href="/Soundness/#14950" class="Bound">Γ</a> <a id="14987" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="14989" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="14990" class="Symbol">}</a> <a id="14992" class="Symbol">(</a><a id="14993" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="14995" href="plfa.Soundness.html#14954" class="Bound">M</a><a id="14996" class="Symbol">)</a> <a id="14998" class="Symbol">(</a><a id="14999" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="15001" href="plfa.Soundness.html#14956" class="Bound">N</a><a id="15002" class="Symbol">)</a>
    <a id="15008" class="Comment">---------------------------</a>
  <a id="15038" class="Symbol">→</a> <a id="15040" href="/Soundness/#14954" class="Bound">M</a> <a id="15042" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15044" href="plfa.Soundness.html#14956" class="Bound">N</a>
<a id="15046" href="/Soundness/#14934" class="Function">lambda-inj</a> <a id="15057" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="15062" class="Symbol">=</a> <a id="15064" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>
<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15470" href="/Soundness/#15470" class="Function">split</a> <a id="15476" class="Symbol">:</a> <a id="15478" class="Symbol">∀</a> <a id="15480" class="Symbol">{</a><a id="15481" href="plfa.Soundness.html#15481" class="Bound">Γ</a><a id="15482" class="Symbol">}</a> <a id="15484" class="Symbol">{</a><a id="15485" href="plfa.Soundness.html#15485" class="Bound">M</a> <a id="15487" class="Symbol">:</a> <a id="15489" href="plfa.Soundness.html#15481" class="Bound">Γ</a> <a id="15491" href="/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="15493" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="15495" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15497" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15498" class="Symbol">}</a> <a id="15500" class="Symbol">{</a><a id="15501" href="plfa.Soundness.html#15501" class="Bound">δ</a> <a id="15503" class="Symbol">:</a> <a id="15505" href="/Denotational/#7109" class="Function">Env</a> <a id="15509" class="Symbol">(</a><a id="15510" href="plfa.Soundness.html#15481" class="Bound">Γ</a> <a id="15512" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="15514" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15515" class="Symbol">)}</a> <a id="15518" class="Symbol">{</a><a id="15519" href="plfa.Soundness.html#15519" class="Bound">v</a><a id="15520" class="Symbol">}</a>
  <a id="15524" class="Symbol">→</a> <a id="15526" href="/Soundness/#15501" class="Bound">δ</a> <a id="15528" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="15530" href="plfa.Soundness.html#15485" class="Bound">M</a> <a id="15532" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="15534" href="plfa.Soundness.html#15519" class="Bound">v</a>
    <a id="15540" class="Comment">--------------------------</a>
  <a id="15569" class="Symbol">→</a> <a id="15571" class="Symbol">(</a><a id="15572" href="/Denotational/#7503" class="Function">init</a> <a id="15577" href="/Soundness/#15501" class="Bound">δ</a> <a id="15579" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="15582" href="plfa.Denotational.html#7558" class="Function">last</a> <a id="15587" href="plfa.Soundness.html#15501" class="Bound">δ</a><a id="15588" class="Symbol">)</a> <a id="15590" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="15592" href="plfa.Soundness.html#15485" class="Bound">M</a> <a id="15594" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="15596" href="plfa.Soundness.html#15519" class="Bound">v</a>
<a id="15598" href="/Soundness/#15470" class="Function">split</a> <a id="15604" class="Symbol">{</a><a id="15605" class="Argument">δ</a> <a id="15607" class="Symbol">=</a> <a id="15609" href="plfa.Soundness.html#15609" class="Bound">δ</a><a id="15610" class="Symbol">}</a> <a id="15612" href="plfa.Soundness.html#15612" class="Bound">δMv</a> <a id="15616" class="Keyword">rewrite</a> <a id="15624" href="/Denotational/#7607" class="Function">init-last</a> <a id="15634" href="plfa.Soundness.html#15609" class="Bound">δ</a> <a id="15636" class="Symbol">=</a> <a id="15638" href="plfa.Soundness.html#15612" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15643" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="15657" class="Symbol">:</a> <a id="15659" class="Symbol">∀</a> <a id="15661" class="Symbol">{</a><a id="15662" href="plfa.Soundness.html#15662" class="Bound">Γ</a> <a id="15664" href="plfa.Soundness.html#15664" class="Bound">Δ</a><a id="15665" class="Symbol">}</a> <a id="15667" class="Symbol">{</a><a id="15668" href="plfa.Soundness.html#15668" class="Bound">δ</a> <a id="15670" class="Symbol">:</a> <a id="15672" href="/Denotational/#7109" class="Function">Env</a> <a id="15676" href="plfa.Soundness.html#15664" class="Bound">Δ</a><a id="15677" class="Symbol">}</a> <a id="15679" class="Symbol">{</a><a id="15680" href="plfa.Soundness.html#15680" class="Bound">M</a> <a id="15682" class="Symbol">:</a> <a id="15684" href="plfa.Soundness.html#15662" class="Bound">Γ</a> <a id="15686" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="15688" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15689" class="Symbol">}</a> <a id="15691" class="Symbol">{</a><a id="15692" href="plfa.Soundness.html#15692" class="Bound">v</a><a id="15693" class="Symbol">}</a> <a id="15695" class="Symbol">{</a><a id="15696" href="plfa.Soundness.html#15696" class="Bound">L</a> <a id="15698" class="Symbol">:</a> <a id="15700" href="plfa.Soundness.html#15664" class="Bound">Δ</a> <a id="15702" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="15704" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="15705" class="Symbol">}</a> <a id="15707" class="Symbol">{</a><a id="15708" href="plfa.Soundness.html#15708" class="Bound">σ</a> <a id="15710" class="Symbol">:</a> <a id="15712" href="/Substitution/#2460" class="Function">Subst</a> <a id="15718" href="plfa.Soundness.html#15662" class="Bound">Γ</a> <a id="15720" href="plfa.Soundness.html#15664" class="Bound">Δ</a><a id="15721" class="Symbol">}</a>
  <a id="15725" class="Symbol">→</a> <a id="15727" href="/Soundness/#15668" class="Bound">δ</a> <a id="15729" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="15731" href="plfa.Soundness.html#15696" class="Bound">L</a> <a id="15733" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="15735" href="plfa.Soundness.html#15692" class="Bound">v</a>
  <a id="15739" class="Symbol">→</a> <a id="15741" href="/Untyped/#6921" class="Function">subst</a> <a id="15747" href="/Soundness/#15708" class="Bound">σ</a> <a id="15749" href="plfa.Soundness.html#15680" class="Bound">M</a> <a id="15751" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="15753" href="plfa.Soundness.html#15696" class="Bound">L</a>
    <a id="15759" class="Comment">---------------------------------------</a>
  <a id="15801" class="Symbol">→</a> <a id="15803" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="15806" href="/Soundness/#15806" class="Bound">γ</a> <a id="15808" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="15810" href="/Denotational/#7109" class="Function">Env</a> <a id="15814" href="plfa.Soundness.html#15662" class="Bound">Γ</a> <a id="15816" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="15818" href="plfa.Soundness.html#15668" class="Bound">δ</a> <a id="15820" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="15823" href="plfa.Soundness.html#15708" class="Bound">σ</a> <a id="15825" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="15827" href="plfa.Soundness.html#15806" class="Bound">γ</a>  <a id="15830" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="15833" href="plfa.Soundness.html#15806" class="Bound">γ</a> <a id="15835" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="15837" href="plfa.Soundness.html#15680" class="Bound">M</a> <a id="15839" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="15841" href="plfa.Soundness.html#15692" class="Bound">v</a>

<a id="15844" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="15858" class="Symbol">{</a><a id="15859" class="Argument">M</a> <a id="15861" class="Symbol">=</a> <a id="15863" href="plfa.Soundness.html#15863" class="Bound">M</a><a id="15864" class="Symbol">}{</a><a id="15866" class="Argument">σ</a> <a id="15868" class="Symbol">=</a> <a id="15870" href="plfa.Soundness.html#15870" class="Bound">σ</a><a id="15871" class="Symbol">}</a> <a id="15873" class="Symbol">(</a><a id="15874" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="15878" class="Symbol">{</a><a id="15879" class="Argument">x</a> <a id="15881" class="Symbol">=</a> <a id="15883" href="plfa.Soundness.html#15883" class="Bound">y</a><a id="15884" class="Symbol">})</a> <a id="15887" href="plfa.Soundness.html#15887" class="Bound">eqL</a> <a id="15891" class="Keyword">with</a> <a id="15896" href="plfa.Soundness.html#15863" class="Bound">M</a>
<a id="15898" class="Symbol">...</a> <a id="15902" class="Symbol">|</a> <a id="15904" href="/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="15906" href="/Soundness/#15906" class="Bound">x</a>  <a id="15909" class="Keyword">with</a> <a id="15914" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="15918" class="Symbol">{</a><a id="15919" class="Argument">x</a> <a id="15921" class="Symbol">=</a> <a id="15923" class="Bound">y</a><a id="15924" class="Symbol">}</a>
<a id="15926" class="Symbol">...</a>           <a id="15940" class="Symbol">|</a> <a id="15942" href="/Soundness/#15942" class="Bound">yv</a>  <a id="15946" class="Keyword">rewrite</a> <a id="15954" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="15958" class="Bound">eqL</a> <a id="15962" class="Symbol">=</a> <a id="15964" href="plfa.Soundness.html#13757" class="Function">subst-reflect-var</a> <a id="15982" class="Symbol">{</a><a id="15983" class="Argument">σ</a> <a id="15985" class="Symbol">=</a> <a id="15987" class="Bound">σ</a><a id="15988" class="Symbol">}</a> <a id="15990" href="plfa.Soundness.html#15942" class="Bound">yv</a>
<a id="15993" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16007" class="Symbol">{</a><a id="16008" class="Argument">M</a> <a id="16010" class="Symbol">=</a> <a id="16012" href="plfa.Soundness.html#16012" class="Bound">M</a><a id="16013" class="Symbol">}</a> <a id="16015" class="Symbol">(</a><a id="16016" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="16020" class="Symbol">{</a><a id="16021" class="Argument">x</a> <a id="16023" class="Symbol">=</a> <a id="16025" href="plfa.Soundness.html#16025" class="Bound">y</a><a id="16026" class="Symbol">})</a> <a id="16029" class="Symbol">()</a> <a id="16032" class="Symbol">|</a> <a id="16034" href="plfa.Soundness.html#16034" class="Bound">M₁</a> <a id="16037" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16039" href="plfa.Soundness.html#16039" class="Bound">M₂</a>
<a id="16042" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16056" class="Symbol">{</a><a id="16057" class="Argument">M</a> <a id="16059" class="Symbol">=</a> <a id="16061" href="plfa.Soundness.html#16061" class="Bound">M</a><a id="16062" class="Symbol">}</a> <a id="16064" class="Symbol">(</a><a id="16065" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="16069" class="Symbol">{</a><a id="16070" class="Argument">x</a> <a id="16072" class="Symbol">=</a> <a id="16074" href="plfa.Soundness.html#16074" class="Bound">y</a><a id="16075" class="Symbol">})</a> <a id="16078" class="Symbol">()</a> <a id="16081" class="Symbol">|</a> <a id="16083" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16085" href="plfa.Soundness.html#16085" class="Bound">M′</a>

<a id="16089" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16103" class="Symbol">{</a><a id="16104" class="Argument">M</a> <a id="16106" class="Symbol">=</a> <a id="16108" href="plfa.Soundness.html#16108" class="Bound">M</a><a id="16109" class="Symbol">}{</a><a id="16111" class="Argument">σ</a> <a id="16113" class="Symbol">=</a> <a id="16115" href="plfa.Soundness.html#16115" class="Bound">σ</a><a id="16116" class="Symbol">}</a> <a id="16118" class="Symbol">(</a><a id="16119" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="16126" href="plfa.Soundness.html#16126" class="Bound">d₁</a> <a id="16129" href="plfa.Soundness.html#16129" class="Bound">d₂</a><a id="16131" class="Symbol">)</a> <a id="16133" href="plfa.Soundness.html#16133" class="Bound">eqL</a>
         <a id="16146" class="Keyword">with</a> <a id="16151" href="/Soundness/#16108" class="Bound">M</a>
<a id="16153" class="Symbol">...</a>    <a id="16160" class="Symbol">|</a> <a id="16162" href="/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="16164" href="/Soundness/#16164" class="Bound">x</a> <a id="16166" class="Keyword">with</a> <a id="16171" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="16178" class="Bound">d₁</a> <a id="16181" class="Bound">d₂</a>
<a id="16184" class="Symbol">...</a>    <a id="16191" class="Symbol">|</a> <a id="16193" href="/Soundness/#16193" class="Bound">d′</a> <a id="16196" class="Keyword">rewrite</a> <a id="16204" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16208" class="Bound">eqL</a> <a id="16212" class="Symbol">=</a> <a id="16214" href="plfa.Soundness.html#13757" class="Function">subst-reflect-var</a> <a id="16232" class="Symbol">{</a><a id="16233" class="Argument">σ</a> <a id="16235" class="Symbol">=</a> <a id="16237" class="Bound">σ</a><a id="16238" class="Symbol">}</a> <a id="16240" href="plfa.Soundness.html#16193" class="Bound">d′</a>
<a id="16243" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16257" class="Symbol">(</a><a id="16258" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="16265" href="plfa.Soundness.html#16265" class="Bound">d₁</a> <a id="16268" href="plfa.Soundness.html#16268" class="Bound">d₂</a><a id="16270" class="Symbol">)</a> <a id="16272" class="Symbol">()</a> <a id="16275" class="Symbol">|</a> <a id="16277" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16279" href="plfa.Soundness.html#16279" class="Bound">M′</a>
<a id="16282" href="/Soundness/#15643" class="Function">subst-reflect</a><a id="16295" class="Symbol">{</a><a id="16296" href="plfa.Soundness.html#16296" class="Bound">Γ</a><a id="16297" class="Symbol">}{</a><a id="16299" href="plfa.Soundness.html#16299" class="Bound">Δ</a><a id="16300" class="Symbol">}{</a><a id="16302" href="plfa.Soundness.html#16302" class="Bound">γ</a><a id="16303" class="Symbol">}{</a><a id="16305" class="Argument">σ</a> <a id="16307" class="Symbol">=</a> <a id="16309" href="plfa.Soundness.html#16309" class="Bound">σ</a><a id="16310" class="Symbol">}</a> <a id="16312" class="Symbol">(</a><a id="16313" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="16320" href="plfa.Soundness.html#16320" class="Bound">d₁</a> <a id="16323" href="plfa.Soundness.html#16323" class="Bound">d₂</a><a id="16325" class="Symbol">)</a>
   <a id="16330" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16335" class="Symbol">|</a> <a id="16337" href="/Soundness/#16337" class="Bound">M₁</a> <a id="16340" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="16342" href="plfa.Soundness.html#16342" class="Bound">M₂</a>
     <a id="16350" class="Keyword">with</a> <a id="16355" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16369" class="Symbol">{</a><a id="16370" class="Argument">M</a> <a id="16372" class="Symbol">=</a> <a id="16374" href="plfa.Soundness.html#16337" class="Bound">M₁</a><a id="16376" class="Symbol">}</a> <a id="16378" href="plfa.Soundness.html#16320" class="Bound">d₁</a> <a id="16381" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16386" class="Symbol">|</a> <a id="16388" href="plfa.Soundness.html#15643" class="Function">subst-reflect</a> <a id="16402" class="Symbol">{</a><a id="16403" class="Argument">M</a> <a id="16405" class="Symbol">=</a> <a id="16407" href="plfa.Soundness.html#16342" class="Bound">M₂</a><a id="16409" class="Symbol">}</a> <a id="16411" href="plfa.Soundness.html#16323" class="Bound">d₂</a> <a id="16414" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="16419" class="Symbol">...</a>     <a id="16427" class="Symbol">|</a> <a id="16429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16431" href="/Soundness/#16431" class="Bound">δ₁</a> <a id="16434" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16436" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16438" href="plfa.Soundness.html#16438" class="Bound">subst-δ₁</a> <a id="16447" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16449" href="plfa.Soundness.html#16449" class="Bound">m1</a> <a id="16452" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16454" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16456" class="Symbol">|</a> <a id="16458" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16460" href="plfa.Soundness.html#16460" class="Bound">δ₂</a> <a id="16463" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16465" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16467" href="plfa.Soundness.html#16467" class="Bound">subst-δ₂</a> <a id="16476" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16478" href="plfa.Soundness.html#16478" class="Bound">m2</a> <a id="16481" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16483" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16485" class="Symbol">=</a>
     <a id="16492" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16494" href="/Soundness/#16431" class="Bound">δ₁</a> <a id="16497" href="/Denotational/#8303" class="Function Operator">`⊔</a> <a id="16500" href="plfa.Soundness.html#16460" class="Bound">δ₂</a> <a id="16503" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16505" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16507" href="plfa.Soundness.html#14652" class="Function">subst-⊔</a> <a id="16515" class="Symbol">{</a><a id="16516" class="Argument">γ₁</a> <a id="16519" class="Symbol">=</a> <a id="16521" href="plfa.Soundness.html#16431" class="Bound">δ₁</a><a id="16523" class="Symbol">}{</a><a id="16525" class="Argument">γ₂</a> <a id="16528" class="Symbol">=</a> <a id="16530" href="plfa.Soundness.html#16460" class="Bound">δ₂</a><a id="16532" class="Symbol">}{</a><a id="16534" class="Argument">σ</a> <a id="16536" class="Symbol">=</a> <a id="16538" class="Bound">σ</a><a id="16539" class="Symbol">}</a> <a id="16541" href="plfa.Soundness.html#16438" class="Bound">subst-δ₁</a> <a id="16550" href="plfa.Soundness.html#16467" class="Bound">subst-δ₂</a> <a id="16559" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="16581" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="16588" class="Symbol">(</a><a id="16589" href="plfa.Denotational.html#25246" class="Function">Env⊑</a> <a id="16594" href="/Soundness/#16449" class="Bound">m1</a> <a id="16597" class="Symbol">(</a><a id="16598" href="plfa.Denotational.html#8625" class="Function">EnvConjR1⊑</a> <a id="16609" href="plfa.Soundness.html#16431" class="Bound">δ₁</a> <a id="16612" href="plfa.Soundness.html#16460" class="Bound">δ₂</a><a id="16614" class="Symbol">))</a>
                           <a id="16644" class="Symbol">(</a><a id="16645" href="/Denotational/#25246" class="Function">Env⊑</a> <a id="16650" href="/Soundness/#16478" class="Bound">m2</a> <a id="16653" class="Symbol">(</a><a id="16654" href="plfa.Denotational.html#8722" class="Function">EnvConjR2⊑</a> <a id="16665" href="plfa.Soundness.html#16431" class="Bound">δ₁</a> <a id="16668" href="plfa.Soundness.html#16460" class="Bound">δ₂</a><a id="16670" class="Symbol">))</a> <a id="16673" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16675" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="16678" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16692" class="Symbol">{</a><a id="16693" class="Argument">M</a> <a id="16695" class="Symbol">=</a> <a id="16697" href="plfa.Soundness.html#16697" class="Bound">M</a><a id="16698" class="Symbol">}{</a><a id="16700" class="Argument">σ</a> <a id="16702" class="Symbol">=</a> <a id="16704" href="plfa.Soundness.html#16704" class="Bound">σ</a><a id="16705" class="Symbol">}</a> <a id="16707" class="Symbol">(</a><a id="16708" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="16716" href="plfa.Soundness.html#16716" class="Bound">d</a><a id="16717" class="Symbol">)</a> <a id="16719" href="plfa.Soundness.html#16719" class="Bound">eqL</a> <a id="16723" class="Keyword">with</a> <a id="16728" href="plfa.Soundness.html#16697" class="Bound">M</a>
<a id="16730" class="Symbol">...</a>    <a id="16737" class="Symbol">|</a> <a id="16739" href="/Untyped/#4288" class="InductiveConstructor Operator">`</a> <a id="16741" href="/Soundness/#16741" class="Bound">x</a> <a id="16743" class="Keyword">with</a> <a id="16748" class="Symbol">(</a><a id="16749" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="16757" class="Bound">d</a><a id="16758" class="Symbol">)</a>
<a id="16760" class="Symbol">...</a>             <a id="16776" class="Symbol">|</a> <a id="16778" href="/Soundness/#16778" class="Bound">d′</a> <a id="16781" class="Keyword">rewrite</a> <a id="16789" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16793" class="Bound">eqL</a> <a id="16797" class="Symbol">=</a> <a id="16799" href="plfa.Soundness.html#13757" class="Function">subst-reflect-var</a> <a id="16817" class="Symbol">{</a><a id="16818" class="Argument">σ</a> <a id="16820" class="Symbol">=</a> <a id="16822" class="Bound">σ</a><a id="16823" class="Symbol">}</a> <a id="16825" href="plfa.Soundness.html#16778" class="Bound">d′</a>
<a id="16828" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16842" class="Symbol">{</a><a id="16843" class="Argument">σ</a> <a id="16845" class="Symbol">=</a> <a id="16847" href="plfa.Soundness.html#16847" class="Bound">σ</a><a id="16848" class="Symbol">}</a> <a id="16850" class="Symbol">(</a><a id="16851" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="16859" href="plfa.Soundness.html#16859" class="Bound">d</a><a id="16860" class="Symbol">)</a> <a id="16862" href="plfa.Soundness.html#16862" class="Bound">eq</a> <a id="16865" class="Symbol">|</a> <a id="16867" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="16869" href="plfa.Soundness.html#16869" class="Bound">M′</a>
      <a id="16878" class="Keyword">with</a> <a id="16883" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="16897" class="Symbol">{</a><a id="16898" class="Argument">σ</a> <a id="16900" class="Symbol">=</a> <a id="16902" href="/Untyped/#6629" class="Function">exts</a> <a id="16907" href="plfa.Soundness.html#16847" class="Bound">σ</a><a id="16908" class="Symbol">}</a> <a id="16910" href="plfa.Soundness.html#16859" class="Bound">d</a> <a id="16912" class="Symbol">(</a><a id="16913" href="plfa.Soundness.html#14934" class="Function">lambda-inj</a> <a id="16924" href="plfa.Soundness.html#16862" class="Bound">eq</a><a id="16926" class="Symbol">)</a>
<a id="16928" class="Symbol">...</a> <a id="16932" class="Symbol">|</a> <a id="16934" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16936" href="/Soundness/#16936" class="Bound">δ′</a> <a id="16939" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16941" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16943" href="plfa.Soundness.html#16943" class="Bound">exts-σ-δ′</a> <a id="16953" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16955" href="plfa.Soundness.html#16955" class="Bound">m′</a> <a id="16958" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16960" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="16962" class="Symbol">=</a>
    <a id="16968" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16970" href="/Denotational/#7503" class="Function">init</a> <a id="16975" href="/Soundness/#16936" class="Bound">δ′</a> <a id="16978" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16980" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="16982" class="Symbol">((λ</a> <a id="16986" href="plfa.Soundness.html#16986" class="Bound">x</a> <a id="16988" class="Symbol">→</a> <a id="16990" href="plfa.Soundness.html#11197" class="Function">rename-inc-reflect</a> <a id="17009" class="Symbol">(</a><a id="17010" href="plfa.Soundness.html#16943" class="Bound">exts-σ-δ′</a> <a id="17020" class="Symbol">(</a><a id="17021" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="17023" href="plfa.Soundness.html#16986" class="Bound">x</a><a id="17024" class="Symbol">))))</a> <a id="17029" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
             <a id="17044" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="17052" class="Symbol">(</a><a id="17053" href="plfa.Denotational.html#25674" class="Function">up-env</a> <a id="17060" class="Symbol">(</a><a id="17061" href="/Soundness/#15470" class="Function">split</a> <a id="17067" href="plfa.Soundness.html#16955" class="Bound">m′</a><a id="17069" class="Symbol">)</a> <a id="17071" class="Symbol">(</a><a id="17072" href="/Compositional/#9665" class="Function">var-inv</a> <a id="17080" class="Symbol">(</a><a id="17081" href="plfa.Soundness.html#16943" class="Bound">exts-σ-δ′</a> <a id="17091" href="/Untyped/#3519" class="InductiveConstructor">Z</a><a id="17092" class="Symbol">)))</a> <a id="17096" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17098" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17100" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17114" class="Symbol">(</a><a id="17115" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="17123" href="plfa.Soundness.html#17123" class="Bound">d</a><a id="17124" class="Symbol">)</a> <a id="17126" class="Symbol">()</a> <a id="17129" class="Symbol">|</a> <a id="17131" href="plfa.Soundness.html#17131" class="Bound">M₁</a> <a id="17134" href="/Untyped/#4400" class="InductiveConstructor Operator">·</a> <a id="17136" href="plfa.Soundness.html#17136" class="Bound">M₂</a>

<a id="17140" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17154" class="Symbol">{</a><a id="17155" class="Argument">σ</a> <a id="17157" class="Symbol">=</a> <a id="17159" href="plfa.Soundness.html#17159" class="Bound">σ</a><a id="17160" class="Symbol">}</a> <a id="17162" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="17170" href="plfa.Soundness.html#17170" class="Bound">eq</a> <a id="17173" class="Symbol">=</a>
    <a id="17179" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17181" href="/Denotational/#8274" class="Function">`⊥</a> <a id="17184" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17186" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17188" href="/Soundness/#14398" class="Function">subst-⊥</a> <a id="17196" class="Symbol">{</a><a id="17197" class="Argument">σ</a> <a id="17199" class="Symbol">=</a> <a id="17201" href="plfa.Soundness.html#17159" class="Bound">σ</a><a id="17202" class="Symbol">}</a> <a id="17204" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17206" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a> <a id="17214" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17216" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>

<a id="17219" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17233" class="Symbol">{</a><a id="17234" class="Argument">σ</a> <a id="17236" class="Symbol">=</a> <a id="17238" href="plfa.Soundness.html#17238" class="Bound">σ</a><a id="17239" class="Symbol">}</a> <a id="17241" class="Symbol">(</a><a id="17242" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="17250" href="plfa.Soundness.html#17250" class="Bound">d₁</a> <a id="17253" href="plfa.Soundness.html#17253" class="Bound">d₂</a><a id="17255" class="Symbol">)</a> <a id="17257" href="plfa.Soundness.html#17257" class="Bound">eq</a>
  <a id="17262" class="Keyword">with</a> <a id="17267" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17281" class="Symbol">{</a><a id="17282" class="Argument">σ</a> <a id="17284" class="Symbol">=</a> <a id="17286" href="plfa.Soundness.html#17238" class="Bound">σ</a><a id="17287" class="Symbol">}</a> <a id="17289" href="plfa.Soundness.html#17250" class="Bound">d₁</a> <a id="17292" href="plfa.Soundness.html#17257" class="Bound">eq</a> <a id="17295" class="Symbol">|</a> <a id="17297" href="plfa.Soundness.html#15643" class="Function">subst-reflect</a> <a id="17311" class="Symbol">{</a><a id="17312" class="Argument">σ</a> <a id="17314" class="Symbol">=</a> <a id="17316" href="plfa.Soundness.html#17238" class="Bound">σ</a><a id="17317" class="Symbol">}</a> <a id="17319" href="plfa.Soundness.html#17253" class="Bound">d₂</a> <a id="17322" href="plfa.Soundness.html#17257" class="Bound">eq</a>
<a id="17325" class="Symbol">...</a> <a id="17329" class="Symbol">|</a> <a id="17331" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17333" href="/Soundness/#17333" class="Bound">δ₁</a> <a id="17336" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17338" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17340" href="plfa.Soundness.html#17340" class="Bound">subst-δ₁</a> <a id="17349" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17351" href="plfa.Soundness.html#17351" class="Bound">m1</a> <a id="17354" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17356" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17358" class="Symbol">|</a> <a id="17360" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17362" href="plfa.Soundness.html#17362" class="Bound">δ₂</a> <a id="17365" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17367" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17369" href="plfa.Soundness.html#17369" class="Bound">subst-δ₂</a> <a id="17378" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17380" href="plfa.Soundness.html#17380" class="Bound">m2</a> <a id="17383" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17385" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17387" class="Symbol">=</a>
     <a id="17394" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17396" href="/Soundness/#17333" class="Bound">δ₁</a> <a id="17399" href="/Denotational/#8303" class="Function Operator">`⊔</a> <a id="17402" href="plfa.Soundness.html#17362" class="Bound">δ₂</a> <a id="17405" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17407" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17409" href="plfa.Soundness.html#14652" class="Function">subst-⊔</a> <a id="17417" class="Symbol">{</a><a id="17418" class="Argument">γ₁</a> <a id="17421" class="Symbol">=</a> <a id="17423" href="plfa.Soundness.html#17333" class="Bound">δ₁</a><a id="17425" class="Symbol">}{</a><a id="17427" class="Argument">γ₂</a> <a id="17430" class="Symbol">=</a> <a id="17432" href="plfa.Soundness.html#17362" class="Bound">δ₂</a><a id="17434" class="Symbol">}{</a><a id="17436" class="Argument">σ</a> <a id="17438" class="Symbol">=</a> <a id="17440" class="Bound">σ</a><a id="17441" class="Symbol">}</a> <a id="17443" href="plfa.Soundness.html#17340" class="Bound">subst-δ₁</a> <a id="17452" href="plfa.Soundness.html#17369" class="Bound">subst-δ₂</a> <a id="17461" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="17483" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="17491" class="Symbol">(</a><a id="17492" href="plfa.Denotational.html#25246" class="Function">Env⊑</a> <a id="17497" href="/Soundness/#17351" class="Bound">m1</a> <a id="17500" class="Symbol">(</a><a id="17501" href="plfa.Denotational.html#8625" class="Function">EnvConjR1⊑</a> <a id="17512" href="plfa.Soundness.html#17333" class="Bound">δ₁</a> <a id="17515" href="plfa.Soundness.html#17362" class="Bound">δ₂</a><a id="17517" class="Symbol">))</a>
                            <a id="17548" class="Symbol">(</a><a id="17549" href="/Denotational/#25246" class="Function">Env⊑</a> <a id="17554" href="/Soundness/#17380" class="Bound">m2</a> <a id="17557" class="Symbol">(</a><a id="17558" href="plfa.Denotational.html#8722" class="Function">EnvConjR2⊑</a> <a id="17569" href="plfa.Soundness.html#17333" class="Bound">δ₁</a> <a id="17572" href="plfa.Soundness.html#17362" class="Bound">δ₂</a><a id="17574" class="Symbol">))</a> <a id="17577" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17579" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="17581" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17595" class="Symbol">(</a><a id="17596" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="17600" href="plfa.Soundness.html#17600" class="Bound">d</a> <a id="17602" href="plfa.Soundness.html#17602" class="Bound">lt</a><a id="17604" class="Symbol">)</a> <a id="17606" href="plfa.Soundness.html#17606" class="Bound">eq</a>
    <a id="17613" class="Keyword">with</a> <a id="17618" href="/Soundness/#15643" class="Function">subst-reflect</a> <a id="17632" href="plfa.Soundness.html#17600" class="Bound">d</a> <a id="17634" href="plfa.Soundness.html#17606" class="Bound">eq</a>
<a id="17637" class="Symbol">...</a> <a id="17641" class="Symbol">|</a> <a id="17643" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17645" href="/Soundness/#17645" class="Bound">δ</a> <a id="17647" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17649" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17651" href="plfa.Soundness.html#17651" class="Bound">subst-δ</a> <a id="17659" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17661" href="plfa.Soundness.html#17661" class="Bound">m</a> <a id="17663" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17665" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17667" class="Symbol">=</a> <a id="17669" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17671" href="plfa.Soundness.html#17645" class="Bound">δ</a> <a id="17673" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17675" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="17677" href="plfa.Soundness.html#17651" class="Bound">subst-δ</a> <a id="17685" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17687" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="17691" href="plfa.Soundness.html#17661" class="Bound">m</a> <a id="17693" class="Bound">lt</a> <a id="17696" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="17698" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L′</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M′</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v′</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v′ ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code class="highlighter-rouge">δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ′<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ′`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.</p>

<p>We first prove a lemma about <code class="highlighter-rouge">subst-zero</code>, that if
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code>, then
<code class="highlighter-rouge">γ ⊑ (δ , w) × δ ⊢ M ↓ w</code> for some <code class="highlighter-rouge">w</code>.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20122" href="/Soundness/#20122" class="Function">subst-zero-reflect</a> <a id="20141" class="Symbol">:</a> <a id="20143" class="Symbol">∀</a> <a id="20145" class="Symbol">{</a><a id="20146" href="plfa.Soundness.html#20146" class="Bound">Δ</a><a id="20147" class="Symbol">}</a> <a id="20149" class="Symbol">{</a><a id="20150" href="plfa.Soundness.html#20150" class="Bound">δ</a> <a id="20152" class="Symbol">:</a> <a id="20154" href="/Denotational/#7109" class="Function">Env</a> <a id="20158" href="plfa.Soundness.html#20146" class="Bound">Δ</a><a id="20159" class="Symbol">}</a> <a id="20161" class="Symbol">{</a><a id="20162" href="plfa.Soundness.html#20162" class="Bound">γ</a> <a id="20164" class="Symbol">:</a> <a id="20166" href="plfa.Denotational.html#7109" class="Function">Env</a> <a id="20170" class="Symbol">(</a><a id="20171" href="plfa.Soundness.html#20146" class="Bound">Δ</a> <a id="20173" href="/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="20175" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20176" class="Symbol">)}</a> <a id="20179" class="Symbol">{</a><a id="20180" href="plfa.Soundness.html#20180" class="Bound">M</a> <a id="20182" class="Symbol">:</a> <a id="20184" href="plfa.Soundness.html#20146" class="Bound">Δ</a> <a id="20186" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="20188" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="20189" class="Symbol">}</a>
  <a id="20193" class="Symbol">→</a> <a id="20195" href="/Soundness/#20150" class="Bound">δ</a> <a id="20197" href="plfa.Soundness.html#3207" class="Function Operator">`⊢</a> <a id="20200" href="/Untyped/#7333" class="Function">subst-zero</a> <a id="20211" href="plfa.Soundness.html#20180" class="Bound">M</a> <a id="20213" href="plfa.Soundness.html#3207" class="Function Operator">↓</a> <a id="20215" href="plfa.Soundness.html#20162" class="Bound">γ</a>
    <a id="20221" class="Comment">----------------------------------------</a>
  <a id="20264" class="Symbol">→</a> <a id="20266" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="20269" href="/Soundness/#20269" class="Bound">w</a> <a id="20271" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="20273" href="/Denotational/#3971" class="Datatype">Value</a> <a id="20279" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="20281" href="plfa.Soundness.html#20162" class="Bound">γ</a> <a id="20283" href="plfa.Denotational.html#8071" class="Function Operator">`⊑</a> <a id="20286" class="Symbol">(</a><a id="20287" href="plfa.Soundness.html#20150" class="Bound">δ</a> <a id="20289" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="20292" href="plfa.Soundness.html#20269" class="Bound">w</a><a id="20293" class="Symbol">)</a> <a id="20295" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="20297" href="plfa.Soundness.html#20150" class="Bound">δ</a> <a id="20299" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="20301" href="plfa.Soundness.html#20180" class="Bound">M</a> <a id="20303" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="20305" href="plfa.Soundness.html#20269" class="Bound">w</a>
<a id="20307" href="/Soundness/#20122" class="Function">subst-zero-reflect</a> <a id="20326" class="Symbol">{</a><a id="20327" class="Argument">δ</a> <a id="20329" class="Symbol">=</a> <a id="20331" href="plfa.Soundness.html#20331" class="Bound">δ</a><a id="20332" class="Symbol">}</a> <a id="20334" class="Symbol">{</a><a id="20335" class="Argument">γ</a> <a id="20337" class="Symbol">=</a> <a id="20339" href="plfa.Soundness.html#20339" class="Bound">γ</a><a id="20340" class="Symbol">}</a> <a id="20342" href="plfa.Soundness.html#20342" class="Bound">δσγ</a> <a id="20346" class="Symbol">=</a> <a id="20348" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20350" href="/Denotational/#7558" class="Function">last</a> <a id="20355" href="plfa.Soundness.html#20339" class="Bound">γ</a> <a id="20357" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20359" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="20361" href="plfa.Soundness.html#20389" class="Function">lemma</a> <a id="20367" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20369" href="plfa.Soundness.html#20342" class="Bound">δσγ</a> <a id="20373" href="/Untyped/#3519" class="InductiveConstructor">Z</a> <a id="20375" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="20377" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
  <a id="20381" class="Keyword">where</a>
  <a id="20389" href="/Soundness/#20389" class="Function">lemma</a> <a id="20395" class="Symbol">:</a> <a id="20397" href="plfa.Soundness.html#20339" class="Bound">γ</a> <a id="20399" href="/Denotational/#8071" class="Function Operator">`⊑</a> <a id="20402" class="Symbol">(</a><a id="20403" href="plfa.Soundness.html#20331" class="Bound">δ</a> <a id="20405" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="20408" href="plfa.Denotational.html#7558" class="Function">last</a> <a id="20413" href="plfa.Soundness.html#20339" class="Bound">γ</a><a id="20414" class="Symbol">)</a>
  <a id="20418" href="/Soundness/#20389" class="Function">lemma</a> <a id="20424" href="/Untyped/#3519" class="InductiveConstructor">Z</a>  <a id="20427" class="Symbol">=</a>  <a id="20430" href="/Denotational/#5480" class="Function">Refl⊑</a>
  <a id="20438" href="/Soundness/#20389" class="Function">lemma</a> <a id="20444" class="Symbol">(</a><a id="20445" href="/Untyped/#3564" class="InductiveConstructor Operator">S</a> <a id="20447" href="plfa.Soundness.html#20447" class="Bound">x</a><a id="20448" class="Symbol">)</a> <a id="20450" class="Symbol">=</a> <a id="20452" href="/Compositional/#9665" class="Function">var-inv</a> <a id="20460" class="Symbol">(</a><a id="20461" href="plfa.Soundness.html#20342" class="Bound">δσγ</a> <a id="20465" class="Symbol">(</a><a id="20466" href="plfa.Untyped.html#3564" class="InductiveConstructor Operator">S</a> <a id="20468" href="plfa.Soundness.html#20447" class="Bound">x</a><a id="20469" class="Symbol">))</a>
</pre>
<p>We choose <code class="highlighter-rouge">w</code> to be the last value in <code class="highlighter-rouge">γ</code> and we obtain <code class="highlighter-rouge">δ ⊢ M ↓ w</code>
by applying the premise to variable <code class="highlighter-rouge">Z</code>. Finally, to prove
<code class="highlighter-rouge">γ ⊑ (δ , w)</code>, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of <code class="highlighter-rouge">w</code>.
In the induction case, <code class="highlighter-rouge">S x</code>, the premise
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> gives us <code class="highlighter-rouge">δ ⊢ x ↓ γ (S x)</code> and then
using <code class="highlighter-rouge">var-inv</code> we conclude that <code class="highlighter-rouge">γ (S x) ⊑ (δ </code>, w) (S x)`.</p>

<p>Now to prove that substitution reflects denotations.</p>

<pre class="Agda"><a id="substitution-reflect"></a><a id="20948" href="/Soundness/#20948" class="Function">substitution-reflect</a> <a id="20969" class="Symbol">:</a> <a id="20971" class="Symbol">∀</a> <a id="20973" class="Symbol">{</a><a id="20974" href="plfa.Soundness.html#20974" class="Bound">Δ</a><a id="20975" class="Symbol">}</a> <a id="20977" class="Symbol">{</a><a id="20978" href="plfa.Soundness.html#20978" class="Bound">δ</a> <a id="20980" class="Symbol">:</a> <a id="20982" href="/Denotational/#7109" class="Function">Env</a> <a id="20986" href="plfa.Soundness.html#20974" class="Bound">Δ</a><a id="20987" class="Symbol">}</a> <a id="20989" class="Symbol">{</a><a id="20990" href="plfa.Soundness.html#20990" class="Bound">N</a> <a id="20992" class="Symbol">:</a> <a id="20994" href="plfa.Soundness.html#20974" class="Bound">Δ</a> <a id="20996" href="/Untyped/#3168" class="InductiveConstructor Operator">,</a> <a id="20998" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="21000" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21002" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="21003" class="Symbol">}</a> <a id="21005" class="Symbol">{</a><a id="21006" href="plfa.Soundness.html#21006" class="Bound">M</a> <a id="21008" class="Symbol">:</a> <a id="21010" href="plfa.Soundness.html#20974" class="Bound">Δ</a> <a id="21012" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="21014" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="21015" class="Symbol">}</a> <a id="21017" class="Symbol">{</a><a id="21018" href="plfa.Soundness.html#21018" class="Bound">v</a><a id="21019" class="Symbol">}</a>
  <a id="21023" class="Symbol">→</a> <a id="21025" href="/Soundness/#20978" class="Bound">δ</a> <a id="21027" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="21029" href="plfa.Soundness.html#20990" class="Bound">N</a> <a id="21031" href="/Untyped/#7449" class="Function Operator">[</a> <a id="21033" href="plfa.Soundness.html#21006" class="Bound">M</a> <a id="21035" href="plfa.Untyped.html#7449" class="Function Operator">]</a> <a id="21037" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="21039" href="plfa.Soundness.html#21018" class="Bound">v</a>
    <a id="21045" class="Comment">------------------------------------------------</a>
  <a id="21096" class="Symbol">→</a> <a id="21098" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="21101" href="/Soundness/#21101" class="Bound">w</a> <a id="21103" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="21105" href="/Denotational/#3971" class="Datatype">Value</a> <a id="21111" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="21113" href="plfa.Soundness.html#20978" class="Bound">δ</a> <a id="21115" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="21117" href="plfa.Soundness.html#21006" class="Bound">M</a> <a id="21119" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="21121" href="plfa.Soundness.html#21101" class="Bound">w</a>  <a id="21124" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a>  <a id="21127" class="Symbol">(</a><a id="21128" href="plfa.Soundness.html#20978" class="Bound">δ</a> <a id="21130" href="plfa.Denotational.html#7266" class="Function Operator">`,</a> <a id="21133" href="plfa.Soundness.html#21101" class="Bound">w</a><a id="21134" class="Symbol">)</a> <a id="21136" href="plfa.Denotational.html#9283" class="Datatype Operator">⊢</a> <a id="21138" href="plfa.Soundness.html#20990" class="Bound">N</a> <a id="21140" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="21142" href="plfa.Soundness.html#21018" class="Bound">v</a>
<a id="21144" href="/Soundness/#20948" class="Function">substitution-reflect</a> <a id="21165" href="plfa.Soundness.html#21165" class="Bound">d</a> <a id="21167" class="Keyword">with</a> <a id="21172" href="plfa.Soundness.html#15643" class="Function">subst-reflect</a> <a id="21186" href="plfa.Soundness.html#21165" class="Bound">d</a> <a id="21188" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="21193" class="Symbol">...</a>  <a id="21198" class="Symbol">|</a> <a id="21200" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21202" href="/Soundness/#21202" class="Bound">γ</a> <a id="21204" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21206" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21208" href="plfa.Soundness.html#21208" class="Bound">δσγ</a> <a id="21212" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21214" href="plfa.Soundness.html#21214" class="Bound">γNv</a> <a id="21218" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21220" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21222" class="Keyword">with</a> <a id="21227" href="plfa.Soundness.html#20122" class="Function">subst-zero-reflect</a> <a id="21246" href="plfa.Soundness.html#21208" class="Bound">δσγ</a>
<a id="21250" class="Symbol">...</a>    <a id="21257" class="Symbol">|</a> <a id="21259" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21261" href="/Soundness/#21261" class="Bound">w</a> <a id="21263" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21265" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21267" href="plfa.Soundness.html#21267" class="Bound">ineq</a> <a id="21272" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21274" href="plfa.Soundness.html#21274" class="Bound">δMw</a> <a id="21278" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21280" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21282" class="Symbol">=</a> <a id="21284" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21286" href="plfa.Soundness.html#21261" class="Bound">w</a> <a id="21288" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21290" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21292" href="plfa.Soundness.html#21274" class="Bound">δMw</a> <a id="21296" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21298" href="/Denotational/#25246" class="Function">Env⊑</a> <a id="21303" class="Bound">γNv</a> <a id="21307" href="plfa.Soundness.html#21267" class="Bound">ineq</a> <a id="21312" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21314" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code> for some <code class="highlighter-rouge">γ</code>.
Using the former, the <code class="highlighter-rouge">subst-zero-reflect</code> lemma gives
us <code class="highlighter-rouge">γ ⊑ (δ , w)</code> and <code class="highlighter-rouge">δ ⊢ M ↓ w</code>. We conclude that
<code class="highlighter-rouge">δ , w ⊢ N ↓ v</code> by applying the <code class="highlighter-rouge">Env⊑</code> lemma, using
<code class="highlighter-rouge">γ ⊢ N ↓ v</code> and <code class="highlighter-rouge">γ ⊑ (δ , w)</code>.</p>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="21760" href="/Soundness/#21760" class="Function">reflect-beta</a> <a id="21773" class="Symbol">:</a> <a id="21775" class="Symbol">∀{</a><a id="21777" href="plfa.Soundness.html#21777" class="Bound">Γ</a><a id="21778" class="Symbol">}{</a><a id="21780" href="plfa.Soundness.html#21780" class="Bound">γ</a> <a id="21782" class="Symbol">:</a> <a id="21784" href="/Denotational/#7109" class="Function">Env</a> <a id="21788" href="plfa.Soundness.html#21777" class="Bound">Γ</a><a id="21789" class="Symbol">}{</a><a id="21791" href="plfa.Soundness.html#21791" class="Bound">M</a> <a id="21793" href="plfa.Soundness.html#21793" class="Bound">N</a><a id="21794" class="Symbol">}{</a><a id="21796" href="plfa.Soundness.html#21796" class="Bound">v</a><a id="21797" class="Symbol">}</a>
    <a id="21803" class="Symbol">→</a> <a id="21805" href="/Soundness/#21780" class="Bound">γ</a> <a id="21807" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="21809" class="Symbol">(</a><a id="21810" href="plfa.Soundness.html#21793" class="Bound">N</a> <a id="21812" href="/Untyped/#7449" class="Function Operator">[</a> <a id="21814" href="plfa.Soundness.html#21791" class="Bound">M</a> <a id="21816" href="plfa.Untyped.html#7449" class="Function Operator">]</a><a id="21817" class="Symbol">)</a> <a id="21819" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="21821" href="plfa.Soundness.html#21796" class="Bound">v</a>
    <a id="21827" class="Symbol">→</a> <a id="21829" href="/Soundness/#21780" class="Bound">γ</a> <a id="21831" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="21833" class="Symbol">(</a><a id="21834" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="21836" href="plfa.Soundness.html#21793" class="Bound">N</a><a id="21837" class="Symbol">)</a> <a id="21839" href="plfa.Untyped.html#4400" class="InductiveConstructor Operator">·</a> <a id="21841" href="plfa.Soundness.html#21791" class="Bound">M</a> <a id="21843" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="21845" href="plfa.Soundness.html#21796" class="Bound">v</a>
<a id="21847" href="/Soundness/#21760" class="Function">reflect-beta</a> <a id="21860" href="plfa.Soundness.html#21860" class="Bound">d</a>
    <a id="21866" class="Keyword">with</a> <a id="21871" href="/Soundness/#20948" class="Function">substitution-reflect</a> <a id="21892" href="plfa.Soundness.html#21860" class="Bound">d</a>
<a id="21894" class="Symbol">...</a> <a id="21898" class="Symbol">|</a> <a id="21900" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21902" href="/Soundness/#21902" class="Bound">v₂′</a> <a id="21906" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21908" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="21910" href="plfa.Soundness.html#21910" class="Bound">d₁′</a> <a id="21914" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21916" href="plfa.Soundness.html#21916" class="Bound">d₂′</a> <a id="21920" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21922" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="21924" class="Symbol">=</a> <a id="21926" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="21933" class="Symbol">(</a><a id="21934" href="plfa.Denotational.html#9554" class="InductiveConstructor">↦-intro</a> <a id="21942" href="plfa.Soundness.html#21916" class="Bound">d₂′</a><a id="21945" class="Symbol">)</a> <a id="21947" href="plfa.Soundness.html#21910" class="Bound">d₁′</a>


<a id="reflect"></a><a id="21953" href="/Soundness/#21953" class="Function">reflect</a> <a id="21961" class="Symbol">:</a> <a id="21963" class="Symbol">∀</a> <a id="21965" class="Symbol">{</a><a id="21966" href="plfa.Soundness.html#21966" class="Bound">Γ</a><a id="21967" class="Symbol">}</a> <a id="21969" class="Symbol">{</a><a id="21970" href="plfa.Soundness.html#21970" class="Bound">γ</a> <a id="21972" class="Symbol">:</a> <a id="21974" href="/Denotational/#7109" class="Function">Env</a> <a id="21978" href="plfa.Soundness.html#21966" class="Bound">Γ</a><a id="21979" class="Symbol">}</a> <a id="21981" class="Symbol">{</a><a id="21982" href="plfa.Soundness.html#21982" class="Bound">M</a> <a id="21984" href="plfa.Soundness.html#21984" class="Bound">M′</a> <a id="21987" href="plfa.Soundness.html#21987" class="Bound">N</a> <a id="21989" href="plfa.Soundness.html#21989" class="Bound">v</a><a id="21990" class="Symbol">}</a>
  <a id="21994" class="Symbol">→</a> <a id="21996" href="/Soundness/#21970" class="Bound">γ</a> <a id="21998" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="22000" href="plfa.Soundness.html#21987" class="Bound">N</a> <a id="22002" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="22004" href="plfa.Soundness.html#21989" class="Bound">v</a>  <a id="22007" class="Symbol">→</a>  <a id="22010" href="plfa.Soundness.html#21982" class="Bound">M</a> <a id="22012" href="/Untyped/#10105" class="Datatype Operator">—→</a> <a id="22015" href="plfa.Soundness.html#21984" class="Bound">M′</a>  <a id="22019" class="Symbol">→</a>   <a id="22023" href="plfa.Soundness.html#21984" class="Bound">M′</a> <a id="22026" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="22028" href="plfa.Soundness.html#21987" class="Bound">N</a>
    <a id="22034" class="Comment">---------------------------------</a>
  <a id="22070" class="Symbol">→</a> <a id="22072" href="/Soundness/#21970" class="Bound">γ</a> <a id="22074" href="/Denotational/#9283" class="Datatype Operator">⊢</a> <a id="22076" href="plfa.Soundness.html#21982" class="Bound">M</a> <a id="22078" href="plfa.Denotational.html#9283" class="Datatype Operator">↓</a> <a id="22080" href="plfa.Soundness.html#21989" class="Bound">v</a>
<a id="22082" href="/Soundness/#21953" class="Function">reflect</a> <a id="22090" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="22094" class="Symbol">(</a><a id="22095" href="/Untyped/#10155" class="InductiveConstructor">ξ₁</a> <a id="22098" href="plfa.Soundness.html#22098" class="Bound">r</a><a id="22099" class="Symbol">)</a> <a id="22101" class="Symbol">()</a>
<a id="22104" href="/Soundness/#21953" class="Function">reflect</a> <a id="22112" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="22116" class="Symbol">(</a><a id="22117" href="/Untyped/#10245" class="InductiveConstructor">ξ₂</a> <a id="22120" href="plfa.Soundness.html#22120" class="Bound">r</a><a id="22121" class="Symbol">)</a> <a id="22123" class="Symbol">()</a>
<a id="22126" href="/Soundness/#21953" class="Function">reflect</a><a id="22133" class="Symbol">{</a><a id="22134" class="Argument">γ</a> <a id="22136" class="Symbol">=</a> <a id="22138" href="plfa.Soundness.html#22138" class="Bound">γ</a><a id="22139" class="Symbol">}</a> <a id="22141" class="Symbol">(</a><a id="22142" href="/Denotational/#9337" class="InductiveConstructor">var</a><a id="22145" class="Symbol">{</a><a id="22146" class="Argument">x</a> <a id="22148" class="Symbol">=</a> <a id="22150" href="plfa.Soundness.html#22150" class="Bound">x</a><a id="22151" class="Symbol">})</a> <a id="22154" href="/Untyped/#10335" class="InductiveConstructor">β</a> <a id="22156" href="plfa.Soundness.html#22156" class="Bound">mn</a>
    <a id="22163" class="Keyword">with</a> <a id="22168" href="/Denotational/#9337" class="InductiveConstructor">var</a><a id="22171" class="Symbol">{</a><a id="22172" class="Argument">γ</a> <a id="22174" class="Symbol">=</a> <a id="22176" href="/Soundness/#22138" class="Bound">γ</a><a id="22177" class="Symbol">}{</a><a id="22179" class="Argument">x</a> <a id="22181" class="Symbol">=</a> <a id="22183" href="plfa.Soundness.html#22150" class="Bound">x</a><a id="22184" class="Symbol">}</a>
<a id="22186" class="Symbol">...</a> <a id="22190" class="Symbol">|</a> <a id="22192" href="/Soundness/#22192" class="Bound">d′</a> <a id="22195" class="Keyword">rewrite</a> <a id="22203" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22207" class="Bound">mn</a> <a id="22210" class="Symbol">=</a> <a id="22212" href="plfa.Soundness.html#21760" class="Function">reflect-beta</a> <a id="22225" href="plfa.Soundness.html#22192" class="Bound">d′</a>
<a id="22228" href="/Soundness/#21953" class="Function">reflect</a> <a id="22236" href="/Denotational/#9337" class="InductiveConstructor">var</a> <a id="22240" class="Symbol">(</a><a id="22241" href="/Untyped/#10443" class="InductiveConstructor">ζ</a> <a id="22243" href="plfa.Soundness.html#22243" class="Bound">r</a><a id="22244" class="Symbol">)</a> <a id="22246" class="Symbol">()</a>
<a id="22249" href="/Soundness/#21953" class="Function">reflect</a> <a id="22257" class="Symbol">(</a><a id="22258" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="22265" href="plfa.Soundness.html#22265" class="Bound">d₁</a> <a id="22268" href="plfa.Soundness.html#22268" class="Bound">d₂</a><a id="22270" class="Symbol">)</a> <a id="22272" class="Symbol">(</a><a id="22273" href="/Untyped/#10155" class="InductiveConstructor">ξ₁</a> <a id="22276" href="plfa.Soundness.html#22276" class="Bound">r</a><a id="22277" class="Symbol">)</a> <a id="22279" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22284" class="Symbol">=</a> <a id="22286" href="plfa.Denotational.html#9416" class="InductiveConstructor">↦-elim</a> <a id="22293" class="Symbol">(</a><a id="22294" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="22302" href="plfa.Soundness.html#22265" class="Bound">d₁</a> <a id="22305" href="plfa.Soundness.html#22276" class="Bound">r</a> <a id="22307" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22311" class="Symbol">)</a> <a id="22313" href="plfa.Soundness.html#22268" class="Bound">d₂</a>
<a id="22316" href="/Soundness/#21953" class="Function">reflect</a> <a id="22324" class="Symbol">(</a><a id="22325" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="22332" href="plfa.Soundness.html#22332" class="Bound">d₁</a> <a id="22335" href="plfa.Soundness.html#22335" class="Bound">d₂</a><a id="22337" class="Symbol">)</a> <a id="22339" class="Symbol">(</a><a id="22340" href="/Untyped/#10245" class="InductiveConstructor">ξ₂</a> <a id="22343" href="plfa.Soundness.html#22343" class="Bound">r</a><a id="22344" class="Symbol">)</a> <a id="22346" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22351" class="Symbol">=</a> <a id="22353" href="plfa.Denotational.html#9416" class="InductiveConstructor">↦-elim</a> <a id="22360" href="plfa.Soundness.html#22332" class="Bound">d₁</a> <a id="22363" class="Symbol">(</a><a id="22364" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="22372" href="plfa.Soundness.html#22335" class="Bound">d₂</a> <a id="22375" href="plfa.Soundness.html#22343" class="Bound">r</a> <a id="22377" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22381" class="Symbol">)</a>
<a id="22383" href="/Soundness/#21953" class="Function">reflect</a> <a id="22391" class="Symbol">(</a><a id="22392" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="22399" href="plfa.Soundness.html#22399" class="Bound">d₁</a> <a id="22402" href="plfa.Soundness.html#22402" class="Bound">d₂</a><a id="22404" class="Symbol">)</a> <a id="22406" href="/Untyped/#10335" class="InductiveConstructor">β</a> <a id="22408" href="plfa.Soundness.html#22408" class="Bound">mn</a>
    <a id="22415" class="Keyword">with</a> <a id="22420" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="22427" href="/Soundness/#22399" class="Bound">d₁</a> <a id="22430" href="plfa.Soundness.html#22402" class="Bound">d₂</a>
<a id="22433" class="Symbol">...</a> <a id="22437" class="Symbol">|</a> <a id="22439" href="/Soundness/#22439" class="Bound">d′</a> <a id="22442" class="Keyword">rewrite</a> <a id="22450" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22454" class="Bound">mn</a> <a id="22457" class="Symbol">=</a> <a id="22459" href="plfa.Soundness.html#21760" class="Function">reflect-beta</a> <a id="22472" href="plfa.Soundness.html#22439" class="Bound">d′</a>
<a id="22475" href="/Soundness/#21953" class="Function">reflect</a> <a id="22483" class="Symbol">(</a><a id="22484" href="/Denotational/#9416" class="InductiveConstructor">↦-elim</a> <a id="22491" href="plfa.Soundness.html#22491" class="Bound">d₁</a> <a id="22494" href="plfa.Soundness.html#22494" class="Bound">d₂</a><a id="22496" class="Symbol">)</a> <a id="22498" class="Symbol">(</a><a id="22499" href="/Untyped/#10443" class="InductiveConstructor">ζ</a> <a id="22501" href="plfa.Soundness.html#22501" class="Bound">r</a><a id="22502" class="Symbol">)</a> <a id="22504" class="Symbol">()</a>
<a id="22507" href="/Soundness/#21953" class="Function">reflect</a> <a id="22515" class="Symbol">(</a><a id="22516" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="22524" href="plfa.Soundness.html#22524" class="Bound">d</a><a id="22525" class="Symbol">)</a> <a id="22527" class="Symbol">(</a><a id="22528" href="/Untyped/#10155" class="InductiveConstructor">ξ₁</a> <a id="22531" href="plfa.Soundness.html#22531" class="Bound">r</a><a id="22532" class="Symbol">)</a> <a id="22534" class="Symbol">()</a>
<a id="22537" href="/Soundness/#21953" class="Function">reflect</a> <a id="22545" class="Symbol">(</a><a id="22546" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="22554" href="plfa.Soundness.html#22554" class="Bound">d</a><a id="22555" class="Symbol">)</a> <a id="22557" class="Symbol">(</a><a id="22558" href="/Untyped/#10245" class="InductiveConstructor">ξ₂</a> <a id="22561" href="plfa.Soundness.html#22561" class="Bound">r</a><a id="22562" class="Symbol">)</a> <a id="22564" class="Symbol">()</a>
<a id="22567" href="/Soundness/#21953" class="Function">reflect</a> <a id="22575" class="Symbol">(</a><a id="22576" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="22584" href="plfa.Soundness.html#22584" class="Bound">d</a><a id="22585" class="Symbol">)</a> <a id="22587" href="/Untyped/#10335" class="InductiveConstructor">β</a> <a id="22589" href="plfa.Soundness.html#22589" class="Bound">mn</a>
    <a id="22596" class="Keyword">with</a> <a id="22601" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="22609" href="/Soundness/#22584" class="Bound">d</a>
<a id="22611" class="Symbol">...</a> <a id="22615" class="Symbol">|</a> <a id="22617" href="/Soundness/#22617" class="Bound">d′</a> <a id="22620" class="Keyword">rewrite</a> <a id="22628" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22632" class="Bound">mn</a> <a id="22635" class="Symbol">=</a> <a id="22637" href="plfa.Soundness.html#21760" class="Function">reflect-beta</a> <a id="22650" href="plfa.Soundness.html#22617" class="Bound">d′</a>
<a id="22653" href="/Soundness/#21953" class="Function">reflect</a> <a id="22661" class="Symbol">(</a><a id="22662" href="/Denotational/#9554" class="InductiveConstructor">↦-intro</a> <a id="22670" href="plfa.Soundness.html#22670" class="Bound">d</a><a id="22671" class="Symbol">)</a> <a id="22673" class="Symbol">(</a><a id="22674" href="/Untyped/#10443" class="InductiveConstructor">ζ</a> <a id="22676" href="plfa.Soundness.html#22676" class="Bound">r</a><a id="22677" class="Symbol">)</a> <a id="22679" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22684" class="Symbol">=</a> <a id="22686" href="plfa.Denotational.html#9554" class="InductiveConstructor">↦-intro</a> <a id="22694" class="Symbol">(</a><a id="22695" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="22703" href="plfa.Soundness.html#22670" class="Bound">d</a> <a id="22705" href="plfa.Soundness.html#22676" class="Bound">r</a> <a id="22707" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22711" class="Symbol">)</a>
<a id="22713" href="/Soundness/#21953" class="Function">reflect</a> <a id="22721" href="/Denotational/#9678" class="InductiveConstructor">⊥-intro</a> <a id="22729" href="plfa.Soundness.html#22729" class="Bound">r</a> <a id="22731" href="plfa.Soundness.html#22731" class="Bound">mn</a> <a id="22734" class="Symbol">=</a> <a id="22736" href="plfa.Denotational.html#9678" class="InductiveConstructor">⊥-intro</a>
<a id="22744" href="/Soundness/#21953" class="Function">reflect</a> <a id="22752" class="Symbol">(</a><a id="22753" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="22761" href="plfa.Soundness.html#22761" class="Bound">d₁</a> <a id="22764" href="plfa.Soundness.html#22764" class="Bound">d₂</a><a id="22766" class="Symbol">)</a> <a id="22768" href="plfa.Soundness.html#22768" class="Bound">r</a> <a id="22770" href="plfa.Soundness.html#22770" class="Bound">mn</a> <a id="22773" class="Keyword">rewrite</a> <a id="22781" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22785" href="plfa.Soundness.html#22770" class="Bound">mn</a> <a id="22788" class="Symbol">=</a>
   <a id="22793" href="/Denotational/#9753" class="InductiveConstructor">⊔-intro</a> <a id="22801" class="Symbol">(</a><a id="22802" href="/Soundness/#21953" class="Function">reflect</a> <a id="22810" href="plfa.Soundness.html#22761" class="Bound">d₁</a> <a id="22813" href="plfa.Soundness.html#22768" class="Bound">r</a> <a id="22815" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22819" class="Symbol">)</a> <a id="22821" class="Symbol">(</a><a id="22822" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="22830" href="plfa.Soundness.html#22764" class="Bound">d₂</a> <a id="22833" href="plfa.Soundness.html#22768" class="Bound">r</a> <a id="22835" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22839" class="Symbol">)</a>
<a id="22841" href="/Soundness/#21953" class="Function">reflect</a> <a id="22849" class="Symbol">(</a><a id="22850" href="/Denotational/#9884" class="InductiveConstructor">sub</a> <a id="22854" href="plfa.Soundness.html#22854" class="Bound">d</a> <a id="22856" href="plfa.Soundness.html#22856" class="Bound">lt</a><a id="22858" class="Symbol">)</a> <a id="22860" href="plfa.Soundness.html#22860" class="Bound">r</a> <a id="22862" href="plfa.Soundness.html#22862" class="Bound">mn</a> <a id="22865" class="Symbol">=</a> <a id="22867" href="plfa.Denotational.html#9884" class="InductiveConstructor">sub</a> <a id="22871" class="Symbol">(</a><a id="22872" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="22880" href="plfa.Soundness.html#22854" class="Bound">d</a> <a id="22882" href="plfa.Soundness.html#22860" class="Bound">r</a> <a id="22884" href="plfa.Soundness.html#22862" class="Bound">mn</a><a id="22886" class="Symbol">)</a> <a id="22888" href="plfa.Soundness.html#22856" class="Bound">lt</a>
</pre>
<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23063" href="/Soundness/#23063" class="Function">reduce-equal</a> <a id="23076" class="Symbol">:</a> <a id="23078" class="Symbol">∀</a> <a id="23080" class="Symbol">{</a><a id="23081" href="plfa.Soundness.html#23081" class="Bound">Γ</a><a id="23082" class="Symbol">}</a> <a id="23084" class="Symbol">{</a><a id="23085" href="plfa.Soundness.html#23085" class="Bound">M</a> <a id="23087" class="Symbol">:</a> <a id="23089" href="plfa.Soundness.html#23081" class="Bound">Γ</a> <a id="23091" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="23093" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23094" class="Symbol">}</a> <a id="23096" class="Symbol">{</a><a id="23097" href="plfa.Soundness.html#23097" class="Bound">N</a> <a id="23099" class="Symbol">:</a> <a id="23101" href="plfa.Soundness.html#23081" class="Bound">Γ</a> <a id="23103" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23105" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23106" class="Symbol">}</a>
  <a id="23110" class="Symbol">→</a> <a id="23112" href="/Soundness/#23085" class="Bound">M</a> <a id="23114" href="/Untyped/#10105" class="Datatype Operator">—→</a> <a id="23117" href="plfa.Soundness.html#23097" class="Bound">N</a>
    <a id="23123" class="Comment">---------</a>
  <a id="23135" class="Symbol">→</a> <a id="23137" href="/Denotational/#17453" class="Function">ℰ</a> <a id="23139" href="/Soundness/#23085" class="Bound">M</a> <a id="23141" href="plfa.Denotational.html#17635" class="Function Operator">≃</a> <a id="23143" href="plfa.Denotational.html#17453" class="Function">ℰ</a> <a id="23145" href="plfa.Soundness.html#23097" class="Bound">N</a>
<a id="23147" href="/Soundness/#23063" class="Function">reduce-equal</a> <a id="23160" class="Symbol">{</a><a id="23161" href="plfa.Soundness.html#23161" class="Bound">Γ</a><a id="23162" class="Symbol">}{</a><a id="23164" href="plfa.Soundness.html#23164" class="Bound">M</a><a id="23165" class="Symbol">}{</a><a id="23167" href="plfa.Soundness.html#23167" class="Bound">N</a><a id="23168" class="Symbol">}</a> <a id="23170" href="plfa.Soundness.html#23170" class="Bound">r</a> <a id="23172" href="plfa.Soundness.html#23172" class="Bound">γ</a> <a id="23174" href="plfa.Soundness.html#23174" class="Bound">v</a> <a id="23176" class="Symbol">=</a>
    <a id="23182" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23184" class="Symbol">(λ</a> <a id="23187" href="/Soundness/#23187" class="Bound">m</a> <a id="23189" class="Symbol">→</a> <a id="23191" href="plfa.Soundness.html#6649" class="Function">preserve</a> <a id="23200" href="plfa.Soundness.html#23187" class="Bound">m</a> <a id="23202" href="plfa.Soundness.html#23170" class="Bound">r</a><a id="23203" class="Symbol">)</a> <a id="23205" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23207" class="Symbol">(λ</a> <a id="23210" href="plfa.Soundness.html#23210" class="Bound">n</a> <a id="23212" class="Symbol">→</a> <a id="23214" href="plfa.Soundness.html#21953" class="Function">reflect</a> <a id="23222" href="plfa.Soundness.html#23210" class="Bound">n</a> <a id="23224" href="plfa.Soundness.html#23170" class="Bound">r</a> <a id="23226" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="23230" class="Symbol">)</a> <a id="23232" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="23397" href="/Soundness/#23397" class="Function">soundness</a> <a id="23407" class="Symbol">:</a> <a id="23409" class="Symbol">∀{</a><a id="23411" href="plfa.Soundness.html#23411" class="Bound">Γ</a><a id="23412" class="Symbol">}</a> <a id="23414" class="Symbol">{</a><a id="23415" href="plfa.Soundness.html#23415" class="Bound">M</a> <a id="23417" class="Symbol">:</a> <a id="23419" href="plfa.Soundness.html#23411" class="Bound">Γ</a> <a id="23421" href="/Untyped/#4252" class="Datatype Operator">⊢</a> <a id="23423" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23424" class="Symbol">}</a> <a id="23426" class="Symbol">{</a><a id="23427" href="plfa.Soundness.html#23427" class="Bound">N</a> <a id="23429" class="Symbol">:</a> <a id="23431" href="plfa.Soundness.html#23411" class="Bound">Γ</a> <a id="23433" href="plfa.Untyped.html#3168" class="InductiveConstructor Operator">,</a> <a id="23435" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a> <a id="23437" href="plfa.Untyped.html#4252" class="Datatype Operator">⊢</a> <a id="23439" href="plfa.Untyped.html#2876" class="InductiveConstructor">★</a><a id="23440" class="Symbol">}</a>
  <a id="23444" class="Symbol">→</a> <a id="23446" href="/Soundness/#23415" class="Bound">M</a> <a id="23448" href="/Untyped/#11203" class="Datatype Operator">—↠</a> <a id="23451" href="plfa.Untyped.html#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23453" href="plfa.Soundness.html#23427" class="Bound">N</a>
    <a id="23459" class="Comment">-----------------</a>
  <a id="23479" class="Symbol">→</a> <a id="23481" href="/Denotational/#17453" class="Function">ℰ</a> <a id="23483" href="/Soundness/#23415" class="Bound">M</a> <a id="23485" href="plfa.Denotational.html#17635" class="Function Operator">≃</a> <a id="23487" href="plfa.Denotational.html#17453" class="Function">ℰ</a> <a id="23489" class="Symbol">(</a><a id="23490" href="/Untyped/#4340" class="InductiveConstructor Operator">ƛ</a> <a id="23492" href="plfa.Soundness.html#23427" class="Bound">N</a><a id="23493" class="Symbol">)</a>
<a id="23495" href="/Soundness/#23397" class="Function">soundness</a> <a id="23505" class="Symbol">(</a><a id="23506" class="DottedPattern Symbol">.(</a><a id="23508" href="/Untyped/#4340" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="23510" class="DottedPattern Symbol">_)</a> <a id="23513" href="plfa.Untyped.html#11253" class="InductiveConstructor Operator">∎</a><a id="23514" class="Symbol">)</a> <a id="23516" href="plfa.Soundness.html#23516" class="Bound">γ</a> <a id="23518" href="plfa.Soundness.html#23518" class="Bound">v</a> <a id="23520" class="Symbol">=</a> <a id="23522" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="23524" class="Symbol">(λ</a> <a id="23527" href="plfa.Soundness.html#23527" class="Bound">x</a> <a id="23529" class="Symbol">→</a> <a id="23531" href="plfa.Soundness.html#23527" class="Bound">x</a><a id="23532" class="Symbol">)</a> <a id="23534" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23536" class="Symbol">(λ</a> <a id="23539" href="plfa.Soundness.html#23539" class="Bound">x</a> <a id="23541" class="Symbol">→</a> <a id="23543" href="plfa.Soundness.html#23539" class="Bound">x</a><a id="23544" class="Symbol">)</a> <a id="23546" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="23548" href="/Soundness/#23397" class="Function">soundness</a> <a id="23558" class="Symbol">{</a><a id="23559" href="plfa.Soundness.html#23559" class="Bound">Γ</a><a id="23560" class="Symbol">}</a> <a id="23562" class="Symbol">(</a><a id="23563" href="plfa.Soundness.html#23563" class="Bound">L</a> <a id="23565" href="/Untyped/#11309" class="InductiveConstructor Operator">—→⟨</a> <a id="23569" href="plfa.Soundness.html#23569" class="Bound">r</a> <a id="23571" href="plfa.Untyped.html#11309" class="InductiveConstructor Operator">⟩</a> <a id="23573" href="plfa.Soundness.html#23573" class="Bound">M—↠N</a><a id="23577" class="Symbol">)</a> <a id="23579" href="plfa.Soundness.html#23579" class="Bound">γ</a> <a id="23581" href="plfa.Soundness.html#23581" class="Bound">v</a> <a id="23583" class="Symbol">=</a>
   <a id="23588" class="Keyword">let</a> <a id="23592" href="/Soundness/#23592" class="Bound">ih</a> <a id="23595" class="Symbol">=</a> <a id="23597" href="plfa.Soundness.html#23397" class="Function">soundness</a> <a id="23607" href="plfa.Soundness.html#23573" class="Bound">M—↠N</a> <a id="23612" class="Keyword">in</a>
   <a id="23618" class="Keyword">let</a> <a id="23622" href="/Soundness/#23622" class="Bound">e</a> <a id="23624" class="Symbol">=</a> <a id="23626" href="plfa.Soundness.html#23063" class="Function">reduce-equal</a> <a id="23639" href="plfa.Soundness.html#23569" class="Bound">r</a> <a id="23641" class="Keyword">in</a>
   <a id="23647" href="/Denotational/#18040" class="Function">≃-trans</a> <a id="23655" class="Symbol">{</a><a id="23656" href="/Soundness/#23559" class="Bound">Γ</a><a id="23657" class="Symbol">}</a> <a id="23659" href="plfa.Soundness.html#23622" class="Bound">e</a> <a id="23661" href="plfa.Soundness.html#23592" class="Bound">ih</a> <a id="23664" href="plfa.Soundness.html#23579" class="Bound">γ</a> <a id="23666" href="plfa.Soundness.html#23581" class="Bound">v</a>
</pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jeremy Siek</li>
          <li><a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jsiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jsiek</span></a></li><li><a href="https://www.twitter.com/jeremysiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jeremysiek</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<script type="text/javascript">

 // Makes sandwhich menu works
 $('.menu-icon').click(function(){
   $('.trigger').toggle();
 });

 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
